<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://duzexu.github.io</id>
    <title>è‚šè‚šçš„å°çª</title>
    <updated>2024-03-02T08:17:51.963Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://duzexu.github.io"/>
    <link rel="self" href="https://duzexu.github.io/atom.xml"/>
    <subtitle>Talk is cheap, Show me the code.</subtitle>
    <logo>https://duzexu.github.io/images/avatar.png</logo>
    <icon>https://duzexu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2024, è‚šè‚šçš„å°çª</rights>
    <entry>
        <title type="html"><![CDATA[GitHub å¼€å‘è€…å¦‚ä½•é¢†å– StarkNet ç©ºæŠ•]]></title>
        <id>https://duzexu.github.io/post/github-starknet/</id>
        <link href="https://duzexu.github.io/post/github-starknet/">
        </link>
        <updated>2024-03-02T06:31:50.000Z</updated>
        <summary type="html"><![CDATA[<p>å¿«çœ‹çœ‹ä½ èƒ½ä¸èƒ½é¢†åˆ°111.1 æšä»·å€¼ 200 ç¾é‡‘çš„ STRK å¸</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¿«çœ‹çœ‹ä½ èƒ½ä¸èƒ½é¢†åˆ°111.1 æšä»·å€¼ 200 ç¾é‡‘çš„ STRK å¸</p>
<!-- more -->
<p>è¿™å‡ å¤©ï¼ŒStartNet å‘æ”¾äº†ä¸€ç¬”ç©ºæŠ•ï¼Œå¦‚æœæ‚¨æ˜¯ GitHub å¼€å‘è€…ï¼Œå¹¶ä¸”åœ¨ 2023 å¹´ 11 æœˆ 15 æ—¥ä¹‹å‰ï¼Œæ‚¨è‡³å°‘å‘å…¨çƒæ˜Ÿçº§æ’åå‰ 5,000 ä½çš„ç‰ˆæœ¬åº“æäº¤äº†ä¸‰æ¬¡å†…å®¹ã€‚å…¶ä¸­è‡³å°‘ä¸€æ¬¡æäº¤å‘ç”Ÿåœ¨ 2018 å¹´æˆ–ä¹‹åã€‚</p>
<p>è¿™æ˜¯è‹±æ–‡åŸæ–‡ï¼š</p>
<blockquote>
<p>You made at least three commits to a repository that is one of the top 5,000 repositories worldwide, ranked by number of stars, before November 15th, 2023. At least one of these commits occurred during 2018 or later.</p>
</blockquote>
<p>é‚£ä¹ˆæ‚¨åº”è¯¥å¯ä»¥é¢†å–ä¸€ç¬”ç©ºæŠ•ï¼Œæœ¬æ–‡æ•™æ‚¨å¦‚ä½•é¢†å– StarkNet ç©ºæŠ•ã€‚</p>
<h3 id="ç¡®è®¤è‡ªå·±å¯ä»¥é¢†å–å¤šå°‘ä¸ª-strk">ç¡®è®¤è‡ªå·±å¯ä»¥é¢†å–å¤šå°‘ä¸ª STRK</h3>
<p>æ‰“å¼€è¿™ä¸ªé“¾æ¥ï¼šhttps://provisions.starknet.io/</p>
<p><img src="https://duzexu.github.io/post-images/1709363096861.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709363102401.png" alt="" loading="lazy"></p>
<p>åœ¨ç½‘é¡µçš„è¿™ä¸ªæ¡†ä¸­æŒ‰å›¾ç¤ºä¸Šå›¾æ“ä½œ</p>
<p><img src="https://duzexu.github.io/post-images/1709363510864.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709363515835.png" alt="" loading="lazy"></p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å¯ä»¥é¢†å– 111.1 ä¸ª STRK</p>
<p>ä¹Ÿå¯ä»¥ç‚¹è¿›ä¸‹é¢ä¸¤ä¸ªè¿æ¥ç›´æ¥ç”¨ä½ çš„GitHubæ˜µç§°æœç´¢<br>
<a href="https://raw.githubusercontent.com/starknet-io/provisions-data/main/github/github-0.json">github-0.json</a><br>
<a href="https://raw.githubusercontent.com/starknet-io/provisions-data/main/github/github-1.json">github-1.json</a></p>
<p>å¦‚æœä¸åœ¨åå•é‡Œï¼Œåªèƒ½å¤šå¤šè´¡çŒ®å¼€æºç¤¾åŒºï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ç©ºæŠ•äº†ğŸ‘»</p>
<h3 id="é¢†å–ç©ºæŠ•">é¢†å–ç©ºæŠ•</h3>
<p>é¢†å–ç©ºæŠ•ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å®‰è£…é’±åŒ…ï¼Œå®‰è£… Argent X æˆ–è€… Braavos é’±åŒ…ï¼Œç›´æ¥åœ¨å„ä¸ªæµè§ˆå™¨æ’ä»¶å¸‚åœºæœç´¢å³å¯ï¼Œæ¯”å¦‚ Chrome çš„ <a href="https://chromewebstore.google.com/detail/argent-x-starknet-wallet/dlcobpjiigpikoobohmabehhmhfoodbb">Argent X</a> å’Œ<a href="https://chromewebstore.google.com/detail/braavos-smart-wallet/jnlgamecbpmbajjfhmmmlhejkemejdma">Braavos</a>æ’ä»¶<br>
<img src="https://duzexu.github.io/post-images/1709364480505.png" alt="" loading="lazy"><br>
ç„¶ååœ¨é’±åŒ…ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é’±åŒ…</p>
<p><img src="https://duzexu.github.io/post-images/1709364655664.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709364664031.png" alt="" loading="lazy"></p>
<p>åˆ›å»ºåé’±åŒ…ä¹‹åï¼ŒæŒ‰ä¸Šå›¾æ“ä½œ</p>
<p><img src="https://duzexu.github.io/post-images/1709364683636.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709364775174.png" alt="" loading="lazy"></p>
<p>æ¥ç€é€‰æ‹©è‡ªå·±çš„é’±åŒ…ï¼Œç„¶åç™»å½• GitHub è´¦å·</p>
<p><img src="https://duzexu.github.io/post-images/1709364791757.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709364798286.png" alt="" loading="lazy"></p>
<p>ä¹‹åä¼šç­”å‡ é“é¢˜ï¼Œè·Ÿ Web3 ç›¸å…³ï¼Œéå¸¸ç®€å•ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œç­”å®Œé¢˜åå°±ä¼š StartNet å°±ä¼šé€šè¿‡é“¾ä¸Šè½¬è´¦è½¬åˆ°ä½ çš„é’±åŒ…å½“ä¸­<br>
<img src="https://duzexu.github.io/post-images/1709364858815.png" alt="" loading="lazy"><br>
ç¨ç­‰ç‰‡åˆ»å³å¯ï¼Œä¸Šå›¾å°±æ˜¯é¢†å–æˆåŠŸçš„ç•Œé¢ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°ä½ çš„Braavosé’±åŒ…ä¸­æœ‰äº†111.1æšSTRKå¸<br>
<img src="https://duzexu.github.io/post-images/1709365114894.png" alt="" loading="lazy"></p>
<h3 id="å¦‚ä½•æå¸">å¦‚ä½•æå¸</h3>
<p>è¿™é‡Œä¼šä»‹ç»é€šè¿‡<a href="https://www.binance.com/">Binanceï¼ˆå¸å®‰ï¼‰</a>æåˆ°äº¤æ˜“æ‰€çš„æ–¹å¼ï¼Œå½“ç„¶è¿˜æœ‰åˆ«çš„äº¤æ˜“æ‰€ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<p>Binance å¯ä»¥é€šè¿‡ã€Œé“¾ä¸Šå……å¸ã€çš„æ–¹å¼å°† $STRK å……åˆ° Binance ä¸Šï¼Œç„¶åå‡ºå”®æ¢æˆ USDTï¼Œå†é€šè¿‡äº¤æ˜“æ‰€ C2Cï¼Œå¯ä»¥å°† USDT æ¢æˆ CNYï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤</p>
<p>åœ¨ Binance ç½‘é¡µç‰ˆä¸­ï¼š</p>
<p><img src="https://duzexu.github.io/post-images/1709365296906.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709365305602.png" alt="" loading="lazy"></p>
<p>é€‰æ‹©ã€Œå……å€¼åŠ å¯†è´§å¸ã€</p>
<p><img src="https://duzexu.github.io/post-images/1709365314224.png" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1709365440132.png" alt="" loading="lazy"></p>
<p>ç„¶åé€‰æ‹© STRKï¼Œå°±å¯ä»¥å¾—åˆ°å……å€¼åœ°å€ï¼Œç„¶ååœ¨é’±åŒ…ä¸­å¾€è¿™ä¸ªåœ°å€è½¬è´¦å³å¯ï¼Œè½¬è´¦å®Œæˆéœ€è¦ç¨ç­‰ååˆ†é’Ÿï¼Œç¡®è®¤å®Œæˆå°±èƒ½åœ¨Binanceé’±åŒ…çœ‹åˆ°äº†</p>
<figure data-type="image" tabindex="1"><img src="https://duzexu.github.io/post-images/1709366629118.jpg" alt="" loading="lazy"></figure>
<p>åœ¨å°†å¸å……å€¼åˆ° Binance ä¹‹åï¼Œå”®å‡ºå˜æˆ USDTï¼Œç„¶åå°±å¯ä»¥é€šè¿‡äº¤æ˜“æ‰€ C2C çš„æ–¹å¼ï¼Œå°† USDT è½¬æ¢æˆ CNY</p>
<h3 id="ä¸ºä»€ä¹ˆ-starknet-è¦å‘æ”¾ç©ºæŠ•">ä¸ºä»€ä¹ˆ StarkNet è¦å‘æ”¾ç©ºæŠ•</h3>
<ul>
<li>æ¿€åŠ±æ›´å¤šå¼€å‘è€…å‚ä¸å¼€æºé¡¹ç›®ï¼šé€šè¿‡å¯¹å¼€æºé¡¹ç›®è´¡çŒ®è€…è¿›è¡Œä»£å¸ç©ºæŠ•ï¼ŒWeb3 é¡¹ç›®èƒ½å¤Ÿæ¿€åŠ±æ›´å¤šçš„å¼€å‘è€…å‚ä¸åˆ°å¼€æºé¡¹ç›®ä¸­ã€‚è¿™ç§æ¿€åŠ±æœºåˆ¶èƒ½å¤Ÿå¸å¼•é‚£äº›å¯èƒ½å¯¹å¼€æºè´¡çŒ®æ„Ÿåˆ°çŠ¹è±«çš„å¼€å‘è€…ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªå³æ—¶çš„ã€æœ‰å½¢çš„å¥–åŠ±ã€‚éšç€æ›´å¤šçš„å¼€å‘è€…æŠ•å…¥åˆ°å¼€æºé¡¹ç›®ä¸­ï¼Œè¿™äº›é¡¹ç›®çš„å‘å±•é€Ÿåº¦å’Œè´¨é‡éƒ½å°†å¾—åˆ°æå‡ã€‚<br>
ä¿ƒè¿› Web3 æŠ€æœ¯çš„æ™®åŠå’Œç†è§£ï¼šå¯¹äºè®¸å¤šä¼ ç»Ÿçš„å¼€å‘è€…æ¥è¯´ï¼ŒWeb3 ä»ç„¶æ˜¯ä¸€ä¸ªç›¸å¯¹é™Œç”Ÿçš„æ¦‚å¿µã€‚é€šè¿‡å°† Web3 é¡¹ç›®ä¸å¼€æºç¤¾åŒºç»“åˆèµ·æ¥ï¼Œå¯ä»¥å¸®åŠ©ä¼ ç»Ÿå¼€å‘è€…æ›´å®¹æ˜“åœ°äº†è§£å’Œæ¥è§¦åˆ°åŒºå—é“¾å’ŒåŠ å¯†è´§å¸ç›¸å…³çš„æŠ€æœ¯ã€‚è¿™ç§è·¨ç•Œåˆä½œæœ‰åŠ©äºåŠ é€Ÿ Web3 æŠ€æœ¯çš„æ™®åŠå’Œç†è§£ï¼ŒåŒæ—¶ä¹Ÿä¸ºå¼€æºé¡¹ç›®å¼•å…¥äº†æ–°çš„è§†è§’å’ŒæŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚</li>
<li>å¢åŠ å¼€æºé¡¹ç›®çš„å¯æŒç»­æ€§ï¼šå¼€æºé¡¹ç›®çš„å¯æŒç»­æ€§ä¸€ç›´æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œå› ä¸ºè®¸å¤šé¡¹ç›®ä¾èµ–äºå¿—æ„¿è€…çš„è´¡çŒ®å’ŒèµåŠ©ã€‚é€šè¿‡ä»£å¸ç©ºæŠ•ï¼ŒWeb3 é¡¹ç›®å¯ä»¥ä¸ºå¼€æºè´¡çŒ®è€…æä¾›ä¸€ç§æ–°çš„æ”¶å…¥æ¥æºï¼Œå¢åŠ é¡¹ç›®çš„å¸å¼•åŠ›å’Œå¯æŒç»­æ€§ã€‚è¿™ç§è´¢åŠ¡æ¿€åŠ±ä¹Ÿå¯èƒ½é¼“åŠ±æ›´å¤šçš„äººæŠ•å…¥åˆ°é¡¹ç›®çš„é•¿æœŸç»´æŠ¤å’Œå‘å±•ä¸­ã€‚</li>
<li>å»ºç«‹æ›´ç´§å¯†çš„ç¤¾åŒºè”ç³»ï¼šç©ºæŠ•æ´»åŠ¨èƒ½å¤Ÿå¸®åŠ©å»ºç«‹å’ŒåŠ å¼º Web3 é¡¹ç›®ä¸å¼€æºç¤¾åŒºä¹‹é—´çš„è”ç³»ã€‚é€šè¿‡å¯¹å¼€æºè´¡çŒ®è€…çš„å¥–åŠ±ï¼ŒWeb3 é¡¹ç›®å¯ä»¥å±•ç¤ºå®ƒä»¬å¯¹ç¤¾åŒºçš„æ”¯æŒå’Œæ‰¿è¯ºï¼Œä»è€Œå»ºç«‹èµ·æ›´å¼ºçš„ç¤¾åŒºä¿¡ä»»å’Œå¿ è¯šåº¦ã€‚è¿™ç§ç´§å¯†çš„è”ç³»ä¸ä»…æœ‰åŠ©äºé¡¹ç›®çš„é•¿æœŸæˆåŠŸï¼Œä¹Ÿä¸ºå¼€æºè´¡çŒ®è€…æä¾›äº†æ›´å¤šçš„å‚ä¸å’Œå½±å“é¡¹ç›®å‘å±•çš„æœºä¼šã€‚<br>
é¼“åŠ±åˆ›æ–°å’Œå®éªŒï¼šæœ€åï¼Œå¯¹å¼€æºé¡¹ç›®è´¡çŒ®è€…è¿›è¡Œç©ºæŠ•æ˜¯ä¸€ç§é¼“åŠ±åˆ›æ–°å’Œå®éªŒçš„æ–¹å¼ã€‚å®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¥–åŠ±é‚£äº›æ„¿æ„å°è¯•æ–°æŠ€æœ¯å’Œè§£å†³æ–¹æ¡ˆçš„å¼€å‘è€…ã€‚è¿™ç§é¼“åŠ±å¯ä»¥æ¨åŠ¨æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œä¿ƒè¿›æ–°çš„è§£å†³æ–¹æ¡ˆå’Œåº”ç”¨çš„äº§ç”Ÿã€‚</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹ï¼ŒSTRK ç»™çŸ¥å GitHub é¡¹ç›®è´¡çŒ®è€…è¿›è¡Œç©ºæŠ•ä¸ä»…æ˜¯å¯¹è¿™äº›è´¡çŒ®è€…çš„è‚¯å®šï¼Œä¹Ÿæ˜¯æ¨åŠ¨å¼€æºå’ŒWeb3 ç”Ÿæ€ç³»ç»Ÿå‘å±•çš„ä¸€ç§åˆ›æ–°æ–¹å¼ã€‚è¿™ç§è·¨ç•Œåˆä½œçš„æ¨¡å¼ä¸ºå…¶ä»–é¡¹ç›®æä¾›äº†ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„æ¦œæ ·ï¼Œé¢„ç¤ºç€æœªæ¥å¯èƒ½ä¼šæœ‰æ›´å¤šç±»ä¼¼çš„æ´»åŠ¨ï¼Œä¸ºæ•´ä¸ªæŠ€æœ¯ç¤¾åŒºå¸¦æ¥æ­£é¢çš„å½±å“ã€‚</p>
<blockquote>
<p>å¦‚æœæ‚¨è§‰å¾—æœ¬ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©çš„è¯ï¼Œæ‚¨å¯ä»¥è½¬å‡ ä¸ª $STRK ç»™æˆ‘åŠ©æˆ‘ä¹°ä¸€æ¯å’–å•¡ï¼Œæˆ‘çš„é’±åŒ…åœ°å€æ˜¯ï¼š0x015e611ea96a4dac62694a3df55341b182d57dfc09f90193cb9447b1128401ae</p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Unity3D è·¨å¹³å°é€šä¿¡]]></title>
        <id>https://duzexu.github.io/post/unity3d-cross-flatform/</id>
        <link href="https://duzexu.github.io/post/unity3d-cross-flatform/">
        </link>
        <updated>2022-11-22T07:35:38.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»Unityå’ŒiOSå’ŒWindowsé€šä¿¡</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»Unityå’ŒiOSå’ŒWindowsé€šä¿¡</p>
<!-- more -->
<h3 id="1-unityä¸cäº¤äº’">1. Unityä¸C++äº¤äº’</h3>
<p>Windowså¹³å°çš„SDKæ˜¯C++ç¼–å†™çš„DLLåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦Unityå’ŒC++è¿›è¡Œé€šä¿¡</p>
<h4 id="11-åŸºæœ¬æ¦‚å¿µ">1.1 åŸºæœ¬æ¦‚å¿µ</h4>
<ul>
<li>æ‰˜ç®¡(Managed)å’Œéæ‰˜ç®¡(Unmanaged)ï¼š.Netçš„è¿è¡Œç¯å¢ƒæ˜¯CLR(Common Language Runtime)ï¼Œè¿è¡Œåœ¨CLRä¸Šçš„ä»£ç æˆä¸ºæ‰˜ç®¡ä»£ç (Managed Code)ï¼ŒCLRæä¾›äº†è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶(GC)ã€‚è€ŒC++æ˜¯ç¼–è¯‘åç›´æ¥ç”±æ“ä½œç³»ç»Ÿæ‰§è¡Œçš„ä»£ç ï¼Œä¸è¿è¡Œåœ¨CLRä¸Šï¼Œæ‰€ä»¥C++å±äºéæ‰˜ç®¡ä»£ç (Unmanaged Code)ã€‚</li>
<li>P/Invokeï¼šP/Invokeï¼ˆPlatform Invokeï¼Œå¹³å°è°ƒç”¨ï¼‰ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æ‰˜ç®¡ä»£ç ä¸­è°ƒç”¨éæ‰˜ç®¡å‡½æ•°ï¼ŒUnityä¸C++çš„äº¤äº’éƒ½æ˜¯é€šè¿‡P/Invokeå®ç°ã€‚ï¼ˆ[DllImport]ï¼‰</li>
</ul>
<h4 id="12-åˆ›å»ºwrapperå±‚c-dll">1.2 åˆ›å»ºWrapperå±‚C++ DLL</h4>
<p>åœ¨VSä¸­æ–°å»ºDLLé¡¹ç›®ï¼ŒæŠŠå¼•ç”¨çš„IMå’ŒRTCåº“æ‹–å…¥é¡¹ç›®ï¼Œåœ¨é¡¹ç›®å±æ€§ä¸­è®¾ç½®å¥½*.dll.libé“¾æ¥åœ°å€ä»¥åŠå¤´æ–‡ä»¶é“¾æ¥åœ°å€ï¼ˆå¦‚ä¸‹å›¾ï¼‰<br>
<img src="https://duzexu.github.io/post-images/1669109075965.PNG" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1669109190019.PNG" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1669109197157.PNG" alt="" loading="lazy"><br>
<img src="https://duzexu.github.io/post-images/1669109202942.PNG" alt="" loading="lazy"><br>
æ–°å»ºä¸€ä¸ªç±»RTCInterface.hå’ŒRTCInterface.cpp</p>
<pre><code class="language-c++">//RTCInterface.h

extern &quot;C&quot;
{
    __declspec(dllexport) RCRTCEngine *rcrtc_create_engine(void* im_client);
    //__declspec(dllexport)å¿…é¡»æ·»åŠ 
}
</code></pre>
<pre><code class="language-c++">//RTCInterface.cpp
#include &quot;RTCInterface.h&quot;

extern &quot;C&quot;
{
    RCRTCEngine *rcrtc_create_engine(void* im_client)
    {
        //code...
    }
}
</code></pre>
<h4 id="13-cè°ƒç”¨">1.3 C#è°ƒç”¨</h4>
<p>å³é”®é¡¹ç›®ç”ŸæˆDLLåï¼Œå°†ç”Ÿæˆçš„DLLä»¥åŠä¾èµ–çš„DLLæ‹·è´åˆ°Unityé¡¹ç›®å¯¹åº”æ¶æ„çš„ç›®å½•ä¸­ï¼Œè®¾ç½®å¥½å¯¹åº”çš„æ¶æ„<br>
<img src="https://duzexu.github.io/post-images/1669109332762.PNG" alt="" loading="lazy"></p>
<p>åœ¨Unityä¸­æ–°å»ºNativeWin.csè„šæœ¬</p>
<pre><code class="language-c#">//NativeWin.cs
namespace cn_rongcloud_rtc_unity
{
    internal class NativeWin
    {
        [DllImport(&quot;RTCWinWapper&quot;, CharSet = CharSet.Ansi, CallingConvention = CallingConvention.Cdecl)]
        internal static extern IntPtr rcrtc_create_engine(IntPtr client);
        //DllImportåé¢çš„åç§°éœ€è¦å’Œå¼•å…¥çš„DLLåç§°ä¸€è‡´
    }
}
</code></pre>
<p>è¿™æ ·åœ¨C#ä¸­è°ƒç”¨NativeWinçš„createæ–¹æ³•å°±å¯ä»¥è°ƒç”¨åˆ°C++çš„ä»£ç äº†</p>
<h4 id="14-å…¶ä»–æƒ…å†µ">1.4 å…¶ä»–æƒ…å†µ</h4>
<ul>
<li>å‚æ•°ä¸­æœ‰ç±»</li>
</ul>
<p>éœ€è¦åœ¨C#å’ŒWrapperä¸­å£°æ˜å¯¹åº”çš„ç»“æ„ä½“ï¼ŒC#ç«¯å°†C#ç±»è½¬ä¸ºç»“æ„ä½“ï¼ŒWrapperä¸­å°†ç»“æ„ä½“è½¬ä¸ºC++ç±»</p>
<pre><code class="language-c#">//å£°æ˜ç»“æ„ä½“
[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
internal struct rtc_engine_setup
{
    [MarshalAs(UnmanagedType.U1)] 
    public bool reconnectable;

    public int statsReportInterval;

    [MarshalAs(UnmanagedType.U1)] 
    public bool enableSRTP;
    public IntPtr audioSetup;
    public IntPtr videoSetup;
    public string mediaUrl;
    public string logPath;
}

//å£°æ˜æ–¹æ³•
[DllImport(&quot;RTCWinWapper&quot;, CharSet = CharSet.Ansi, CallingConvention = CallingConvention.Cdecl)]
internal static extern IntPtr rcrtc_create_engine_with_setup(IntPtr client, ref rtc_engine_setup setup);

//è°ƒç”¨æ–¹æ³•
internal RCRTCEngineWin(RCRTCEngineSetup setup)
{
    //è½¬æ¢æˆç»“æ„ä½“
    rtc_engine_setup cobject;
    cobject.reconnectable = setup.IsReconnectable();
    if (setup.GetAudioSetup() != null)
    {
        rtc_audio_setup audio;
        audio.audioCodecType = (int)setup.GetAudioSetup().GetAudioCodecType();
        IntPtr ptr = Marshal.AllocHGlobal(Marshal.SizeOf(audio));
        Marshal.StructureToPtr(audio, ptr, true);
        cobject.audioSetup = ptr;
     }
     else
     {
         cobject.audioSetup = IntPtr.Zero;
     }
     //other paramers...
     
     //è°ƒç”¨æ–¹æ³•
     rtc_engine = NativeWin.rcrtc_create_engine_with_setup(im_client, ref cobject);
     if (cobject.audioSetup != IntPtr.Zero)
     {
        Marshal.FreeHGlobal(cobject.audioSetup);
     }
}
</code></pre>
<p>æ³¨æ„ï¼š<br>
ç»“æ„ä½“ä¸­æœ‰Booléœ€è¦æŒ‡å®šéæ‰˜ç®¡ç±»å‹ä¸ºUnmanagedType.U1,å¯ä»¥å‘ŠçŸ¥è¿è¡Œæ—¶å°†å­—æ®µä½œä¸º 1 å­—èŠ‚æœ¬æœº bool ç±»å‹è¿›è¡Œå°é€<br>
ç»“æ„ä½“ä¸­æœ‰å…¶ä»–çš„ç±»éœ€è¦ä½¿ç”¨Marshal.AllocHGlobalåœ¨éæ‰˜ç®¡å†…å­˜ä¸­åˆ†é…å†…å­˜ï¼Œä½¿ç”¨ç»“æŸåéœ€æ‰‹åŠ¨è°ƒç”¨Marshal.FreeHGlobalé‡Šæ”¾</p>
<pre><code class="language-c++">//RTCInterface.cpp
#include &quot;RTCInterface.h&quot;

extern &quot;C&quot;
{
    //å£°æ˜ç»“æ„ä½“
    typedef struct rtc_engine_setup
    {
        bool reconnectable;
        int statsReportInterval;
        bool enableSRTP;
        rtc_audio_setup* audioSetup;
        rtc_video_setup* videoSetup;
        const char* mediaUrl;
        const char* logPath;
    } rtc_engine_setup;

    RCRTCEngine *rcrtc_create_engine_with_setup(void *im_client, rtc_engine_setup *csetup)
    {
        RCRTCEngineSetup *setup = RCRTCEngineSetup::create();
        setup-&gt;setEnableSRTP(csetup-&gt;enableSRTP);
        //other params...
        RCRTCEngine *engine = RCRTCEngine::create(im_client, setup);
        return engine;
    }
}
</code></pre>
<ul>
<li>å›è°ƒUnityæ–¹æ³•</li>
</ul>
<pre><code class="language-c#">//C#ä¸­å£°æ˜å›è°ƒ
public delegate void OnRoomJoinedDelegate(int code, String errMsg);

//å®ç°å›è°ƒæ–¹æ³•
[MonoPInvokeCallback(typeof(OnRoomJoinedDelegate))]
private static void on_rtc_room_joined(int code, string message)
{
    //code...
}

//å£°æ˜è°ƒç”¨æ–¹æ³•
[DllImport(&quot;RTCWinWapper&quot;, CallingConvention = CallingConvention.Cdecl, CharSet = CharSet.Ansi)]
internal static extern void rcrtc_set_engine_listeners(OnRoomJoinedDelegate on_rtc_room_joined);

//è®¾ç½®å›è°ƒ 
NativeWin.rcrtc_set_engine_listeners(on_rtc_room_joined);
</code></pre>
<pre><code class="language-c++">extern &quot;C&quot;
{
    //wrapperä¸­å£°æ˜å›è°ƒ
    typedef void (*on_rtc_room_joined)(int code, const char* message);
    
    //å£°æ˜è°ƒç”¨æ–¹æ³•
    void rcrtc_set_engine_listeners(on_rtc_room_joined _on_rtc_room_joined)
    {
        //ç›´æ¥è°ƒç”¨
        _on_rtc_room_joined(0, &quot;error msg&quot;);
    }
}
</code></pre>
<h3 id="2-unityå’Œiosäº¤äº’">2. Unityå’ŒiOSäº¤äº’</h3>
<p>Unityå’ŒiOSçš„äº¤äº’å’Œè·ŸC++çš„äº¤äº’è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œä¹Ÿæ˜¯é€šè¿‡DllImportè°ƒç”¨éæ‰˜ç®¡å‡½æ•°</p>
<h4 id="21-åˆ›å»ºwrapperå±‚framework">2.1 åˆ›å»ºWrapperå±‚framework</h4>
<p>æ–°å»ºXcode frameworké¡¹ç›®,å°†ä½¿ç”¨çš„åº“æ‹–å…¥é¡¹ç›®<br>
<img src="https://duzexu.github.io/post-images/1669110298035.PNG" alt="" loading="lazy"></p>
<p>æ–°å»ºä¸€ä¸ªäº¤äº’ç±»RongUnityRTC.mm</p>
<pre><code class="language-c++">//RongUnityRTC.mm

extern &quot;C&quot; {
    //å£°æ˜ç»“æ„ä½“
    typedef struct rtc_engine_setup {
      bool reconnectable;
      int statsReportInterval;
      bool enableSRTP;
      rtc_audio_setup *audioSetup;
      rtc_video_setup *videoSetup;
      const char *mediaUrl;
    } rtc_engine_setup;
    
    //å£°æ˜åˆ›å»ºæ–¹æ³•
    CFTypeRef rtc_create_engine_with_setup(rtc_engine_setup *csetup) {
      RCRTCIWEngineSetup *setup = [[RCRTCIWEngineSetup alloc] init];
      setup.enableSRTP = csetup-&gt;enableSRTP;
      if (csetup-&gt;audioSetup != NULL) {
        RCRTCIWAudioSetup *audioSetup = [[RCRTCIWAudioSetup alloc] init];
        audioSetup.type = (RCRTCIWAudioCodecType)csetup-&gt;audioSetup-&gt;audioCodecType;
        audioSetup.mixOtherAppsAudio = csetup-&gt;audioSetup-&gt;mixOtherAppsAudio;
        setup.audioSetup = audioSetup;
      }
      //other params...
      engine = [RCRTCIWEngine create:setup];
      return CFBridgingRetain(engine);
    }
    
    //å£°æ˜å›è°ƒ
    typedef void (*on_rtc_room_joined)(int code, const char* message);
    
    //å£°æ˜è°ƒç”¨æ–¹æ³•
    void rcrtc_set_engine_listeners(on_rtc_room_joined _on_rtc_room_joined)
    {
        //ç›´æ¥è°ƒç”¨
        _on_rtc_room_joined(0, &quot;error msg&quot;);
    }
}
</code></pre>
<h4 id="22-cè°ƒç”¨">2.2 C#è°ƒç”¨</h4>
<p>Build wrapperé¡¹ç›®ï¼Œæ‹·è´ç”Ÿæˆçš„frameworkä»¥åŠä¾èµ–çš„fraworkåˆ°Unityä¸­ï¼Œå¹¶è®¾ç½®å¥½å¯¹åº”çš„æ¶æ„<br>
<img src="https://duzexu.github.io/post-images/1669110428675.PNG" alt="" loading="lazy"><br>
åœ¨Unityä¸­æ–°å»ºNativeIOS.csè„šæœ¬</p>
<pre><code class="language-c#">//NativeIOS.cs
namespace cn_rongcloud_rtc_unity
{
    //å£°æ˜ç»“æ„ä½“
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
    internal struct rtc_engine_setup
    {
        [MarshalAs(UnmanagedType.U1)] 
        public bool reconnectable;

        public int statsReportInterval;

        [MarshalAs(UnmanagedType.U1)] 
        public bool enableSRTP;
        public IntPtr audioSetup;
        public IntPtr videoSetup;
        public string mediaUrl;
        public string logPath;
    }

    internal class NativeIOS
    {
        [DllImport(&quot;__Internal&quot;, CallingConvention = CallingConvention.Cdecl, CharSet = CharSet.Ansi)]
        internal static extern IntPtr rtc_create_engine_with_setup(ref rtc_engine_setup setup);
        //DllImportåé¢çš„åç§°å¿…é¡»ä¸º__Internal

        [DllImport(&quot;__Internal&quot;, CallingConvention = CallingConvention.Cdecl, CharSet = CharSet.Ansi)]
        internal static extern void rcrtc_set_engine_listeners(OnRoomJoinedDelegate on_rtc_room_joined)
    }
}

//C#ä¸­å£°æ˜å›è°ƒ
public delegate void OnRoomJoinedDelegate(int code, String errMsg);

//å®ç°å›è°ƒæ–¹æ³•
[MonoPInvokeCallback(typeof(OnRoomJoinedDelegate))]
private static void on_rtc_room_joined(int code, string message)
{
    //code...
}
</code></pre>
<p>è°ƒç”¨è·ŸC++ä¸€è‡´</p>
<pre><code class="language-c#">//è°ƒç”¨æ–¹æ³•
internal RCRTCEngineIOS(RCRTCEngineSetup setup)
{
    //è®¾ç½®å›è°ƒ 
    NativeIOS.rcrtc_set_engine_listeners(on_rtc_room_joined);
    //è½¬æ¢æˆç»“æ„ä½“
    rtc_engine_setup cobject;
    cobject.reconnectable = setup.IsReconnectable();
    if (setup.GetAudioSetup() != null)
    {
        rtc_audio_setup audio;
        audio.audioCodecType = (int)setup.GetAudioSetup().GetAudioCodecType();
        IntPtr ptr = Marshal.AllocHGlobal(Marshal.SizeOf(audio));
        Marshal.StructureToPtr(audio, ptr, true);
        cobject.audioSetup = ptr;
     }
     else
     {
         cobject.audioSetup = IntPtr.Zero;
     }
     //other paramers...
     
     //è°ƒç”¨æ–¹æ³•
     rtc_engine = NativeIOS.rcrtc_create_engine_with_setup(im_client, ref cobject);
     if (cobject.audioSetup != IntPtr.Zero)
     {
        Marshal.FreeHGlobal(cobject.audioSetup);
     }
}
</code></pre>
<h4 id="23-å…¶ä»–æƒ…å†µ">2.3 å…¶ä»–æƒ…å†µ</h4>
<ul>
<li>å¯¹è±¡æœ‰ç»§æ‰¿å…³ç³»</li>
</ul>
<p>c#ä¸º<code>ios_class_warpper</code>å¯¹è±¡ , <code>type</code> ä¿å­˜ç±»å, <code>obj</code> å­˜çœŸæ­£çš„å¯¹è±¡æŒ‡é’ˆ</p>
<pre><code class="language-c#">[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
internal struct ios_class_warpper
{
    public IntPtr obj;
    public string type;
}

internal static ios_class_warpper toMessageWapper(RCIMMessage message)
{
    ios_class_warpper message_wapper;
    if (message is RCIMUnknownMessage)
    {
        im_unknown_message cmessage = toUnknownMessage((RCIMUnknownMessage)message);
        IntPtr message_ptr = Marshal.AllocHGlobal(Marshal.SizeOf(cmessage));
        Marshal.StructureToPtr(cmessage, message_ptr, false);
        message_wapper.obj = message_ptr;
        message_wapper.type = &quot;RCIMIWUnknownMessage&quot;;
    }
    else if (message is RCIMCustomMessage)
    {
        //...
    }
}
</code></pre>
<p>ocè½¬æ¢åˆ™æ˜¯æ ¹æ®typeåˆå§‹åŒ–å¯¹åº”çš„å¯¹è±¡</p>
<pre><code class="language-Objective-C">+ (RCIMIWMessage *)fromMessageWapper:(struct ios_class_warpper *)cmessage {
  if (cmessage == NULL || cmessage-&gt;obj == NULL || cmessage-&gt;type == NULL) {
    return nil;
  }
  RCIMIWMessage *message_wapper = nil;
  NSString *type = [NSString stringWithUTF8String:cmessage-&gt;type];
  if ([type isEqualToString:@&quot;RCIMIWUnknownMessage&quot;]) {
    message_wapper =
        [self fromUnknownMessage:(im_unknown_message *)cmessage-&gt;obj];
  }else if //...
 }
</code></pre>
<p>è½¬æ¢å›æ¥çš„è¿‡ç¨‹åˆ™æ˜¯ç›¸åçš„</p>
<ul>
<li>æ•°ç»„</li>
</ul>
<p>c#è½¬ä¸º ios_c_listå¯¹è±¡ï¼Œlistå­˜æ•°ç»„æŒ‡é’ˆï¼Œcountå­˜æ•°ç»„æ•°é‡</p>
<pre><code class="language-c#">[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
internal struct ios_c_list
{
    public IntPtr list;
    public long count;
}

//è½¬åˆ°ios
internal static IntPtr GetStructMapPointer&lt;StructType&gt;(ref List&lt;StructType&gt; clist)
{
     int size = Marshal.SizeOf(typeof(StructType));
     IntPtr list_ptr = Marshal.AllocHGlobal(clist.Count * size);
     for (int i = 0; i &lt; clist.Count; i++)
     {
          Marshal.StructureToPtr(clist[i], list_ptr+size*i, false);
     }
     ios_c_list map;
     map.list = list_ptr;
     map.count = clist.Count;
     IntPtr map_ptr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ios_c_list)));
     Marshal.StructureToPtr(map, map_ptr, false);
     return map_ptr;
}
//ä»iosè½¬å›
internal static List&lt;StructType&gt; GetObjectListByPtr&lt;StructType&gt;(IntPtr ptr)
{
    if (ptr == IntPtr.Zero)
    {
        return new List&lt;StructType&gt;();
    }
    ios_c_list clist = Marshal.PtrToStructure&lt;ios_c_list&gt;(ptr);
    StructType[] cobjects = new StructType[clist.count];
    for (uint i = 0; i &lt; clist.count; ++i)
    {
       IntPtr item_ptr = new IntPtr(ptr.ToInt64() + Marshal.SizeOf(typeof(StructType)) * i);

       if ((item_ptr != null))
       {
           cobjects.Add((StructType)Marshal.PtrToStructure(item_ptr, typeof(StructType)));
       }
    }
    return new List&lt;StructType&gt;(cobjects);
}
</code></pre>
<p>ocæ ¹æ®countéå†</p>
<pre><code class="language-oc">typedef struct ios_c_list {
  void *list;
  unsigned long count;
} ios_c_list;
//ä»c#
ios_class_warpper *messages_iter = c_list-&gt;list;
for (int i = 0; i &lt; c_list-&gt;count; i++) {
    //   messages_iter ... 
    messages_iter++;
}
//è½¬åˆ°c#
//NSArray&lt;RCIMIWMessage *&gt; *messages = ...
 ios_c_list *clist = (ios_c_list *)malloc(sizeof(ios_c_list));
 memset(clist, 0, sizeof(ios_c_list));
 ios_class_warpper *cmessages = (ios_class_warpper *)malloc(
          sizeof(ios_class_warpper) * messages.count);
 memset(cmessages, 0, sizeof(ios_class_warpper) * messages.count);
 ios_class_warpper *messages_iter = cmessages;
 for (int i = 0; i &lt; messages.count; i++) {
     [RongUnityConvert makeMessageWapper:messages[i] to:messages_iter];
     messages_iter++;
 }
 clist-&gt;list = cmessages;
 clist-&gt;count = messages.count;
 return clist;
</code></pre>
<ul>
<li>å­—ç¬¦ä¸²æ•°ç»„</li>
</ul>
<p>å’Œæ•°ç»„ä¸åŒçš„ç‚¹æ˜¯å­—ç¬¦ä¸²éœ€è¦è½¬æ¢ä¸ºæŒ‡é’ˆï¼Œåˆ™ç»“æ„å°±æ˜¯æŒ‡é’ˆæ•°ç»„</p>
<pre><code class="language-c#">//è½¬åˆ°ios
internal static IntPtr GetStringListPointer(List&lt;string&gt; clist)
{
      IntPtr[] ptrArray = new IntPtr[clist.Count];
      for (int i = 0; i &lt; clist.Count; i++)
      {
          ptrArray[i] = Marshal.StringToHGlobalAnsi(clist[i]);
      }
      IntPtr list_ptr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(IntPtr)) * clist.Count);
      for (int j = 0; j &lt; clist.Count; j++)
      {
          IntPtr item_ptr = new IntPtr(list_ptr.ToInt64() + Marshal.SizeOf(typeof(IntPtr)) * j);
          Marshal.StructureToPtr(ptrArray[j], item_ptr, false);
      }
      ios_c_list map;
      map.list = list_ptr;
      map.count = clist.Count;
      IntPtr result_ptr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ios_c_list)));
      Marshal.StructureToPtr(map, result_ptr, false);
      return result_ptr;
}
//ä»iosè½¬å›      
internal static List&lt;string&gt; GetStringListByPtr(IntPtr ptr)
{
    if (ptr == IntPtr.Zero)
    {
        return new List&lt;string&gt;();
    }
    ios_c_list clist = Marshal.PtrToStructure&lt;ios_c_list&gt;(ptr);
    List&lt;string&gt; cobjects = new List&lt;string&gt;();
    for (int i = 0; i &lt; clist.count; i++)
    {
        IntPtr item_ptr = new IntPtr(clist.list.ToInt64() + Marshal.SizeOf(typeof(IntPtr)) * i);
        IntPtr str_ptr = Marshal.PtrToStructure&lt;IntPtr&gt;(item_ptr);
        cobjects.Add(PtrToString(str_ptr));
    }
    return cobjects;
}
        
//éœ€è¦æ³¨æ„é‡Šæ”¾
internal static void FreeStringListByPtr(IntPtr ptr)
{
     if (ptr == IntPtr.Zero)
     {
          return;
     }
     ios_c_list clist = Marshal.PtrToStructure&lt;ios_c_list&gt;(ptr);
     if (clist.list != IntPtr.Zero)
     {
         for (int i = 0; i &lt; clist.count; i++)
         {
             IntPtr item_ptr = new IntPtr(clist.list.ToInt64() + Marshal.SizeOf(typeof(IntPtr)) * i);
             IntPtr str_ptr = Marshal.PtrToStructure&lt;IntPtr&gt;(item_ptr);
             Marshal.FreeHGlobal(str_ptr);
         }
         Marshal.FreeHGlobal(clist.list);
     }
}
</code></pre>
<p>iOSæ¥æ”¶é‡‡ç”¨<code>char*</code>æ•°ç»„æ¥æ”¶</p>
<pre><code class="language-oc">//ä»c#
ios_c_list *clist = (ios_c_list *)cinfo-&gt;userIdList;
NSMutableArray&lt;NSString *&gt; *list =
        [[NSMutableArray alloc] initWithCapacity:clist-&gt;count];
char **iter = (char **)clist-&gt;list;
for (int i = 0; i &lt; clist-&gt;count; i++) {
  if (*iter != NULL) {
     [list addObject:[NSString stringWithUTF8String:*iter]];
  }
  iter++;
}
//ä»iosè½¬å›
//NSArray&lt;NSString *&gt; *keys = ...
ios_c_list *clist = (ios_c_list *)malloc(sizeof(ios_c_list));
memset(clist, 0, sizeof(ios_c_list));
char **cstrings = (char **)malloc(keys.count * sizeof(char *));
char **keys_iter = cstrings;
for (NSUInteger i = 0; i &lt; keys.count; i++) {
     NSString *string = keys[i];
     char *cstring = (char *)malloc(
            [string lengthOfBytesUsingEncoding:NSUTF8StringEncoding] + 1);
     strncpy(cstring, [string UTF8String],
                [string lengthOfBytesUsingEncoding:NSUTF8StringEncoding] + 1);
     *keys_iter = cstring;
     keys_iter++;
}
 clist-&gt;list = cstrings;
 clist-&gt;count = keys.count;
 return clist;
</code></pre>
<ul>
<li>å­—å…¸</li>
</ul>
<p>è½¬æ¢ä¸ºä»¥<code>ios_c_map_item</code>ä¸ºå…ƒç´ çš„æ•°ç»„</p>
<pre><code class="language-c#">[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
internal struct ios_c_map_item
{
    public string key;
    public string value;
}
</code></pre>
<h4 id="24-å†…å­˜ç®¡ç†">2.4 å†…å­˜ç®¡ç†</h4>
<p>è°ƒç”¨å®Œæˆå<br>
c# éæ‰˜ç®¡çš„éœ€è¦æ‰‹åŠ¨é‡Šæ”¾<br>
C mallocçš„å†…å­˜éœ€è¦free</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Macæ­å»ºSTM32ç¯å¢ƒï¼ˆåŸºäºApple siliconï¼‰]]></title>
        <id>https://duzexu.github.io/post/stm32-in-mac/</id>
        <link href="https://duzexu.github.io/post/stm32-in-mac/">
        </link>
        <updated>2022-10-17T08:11:23.000Z</updated>
        <summary type="html"><![CDATA[<p>ä»‹ç»å¦‚ä½•åœ¨Macä¸Šæ­å»ºSTM32ç¯å¢ƒè¿›è¡ŒåµŒå…¥å¼å¼€å‘</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä»‹ç»å¦‚ä½•åœ¨Macä¸Šæ­å»ºSTM32ç¯å¢ƒè¿›è¡ŒåµŒå…¥å¼å¼€å‘</p>
<!-- more -->
<h1 id="åŸºæœ¬å·¥å…·">åŸºæœ¬å·¥å…·</h1>
<h2 id="clionå®‰è£…">Clionå®‰è£…</h2>
<p>ä½¿ç”¨Homebrewå®‰è£…</p>
<pre><code>brew install clion
</code></pre>
<p>æˆ–è€…<a href="https://www.jetbrains.com/zh-cn/clion/">å®˜ç½‘ä¸‹è½½</a></p>
<p>ä¸‹è½½2022.1.13ç‰ˆæœ¬ï¼Œä¸‹è½½ç ´è§£åŒ…è¿›è¡Œç ´è§£</p>
<h2 id="stm32cubemxå®‰è£…">STM32Cubemxå®‰è£…</h2>
<p>å®‰è£…è¿è¡ŒSTM32Cubemxéœ€è¦javaç¯å¢ƒ<a href="https://www.java.com/zh-CN/">ä¸‹è½½åœ°å€</a></p>
<p><a href="https://www.st.com/en/development-tools/stm32cubemx.html#get-software">å®˜ç½‘ä¸‹è½½åœ°å€</a>ï¼Œè¯¥è½¯ä»¶åŸºäºx86æ¶æ„ï¼Œåœ¨Apple siliconä¸Šè¿è¡Œéœ€è¦rosetta2ï¼Œè‹¥ä½ çš„ç”µè„‘æ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥<code>softwareupdate --install-rosetta</code>å‘½ä»¤å®Œæˆå®‰è£…</p>
<p>ä¸‹è½½å¥½åè§£å‹ï¼Œå³é”®SetupSTM32CubeMX-6.5.0é€‰æ‹©æ˜¾ç¤ºåŒ…å†…å®¹ï¼ŒåŒå‡»Contents/MacOs/SetupSTM32CubeMX-6_5_0å³å¯è¿›å…¥å®‰è£…ç•Œé¢ï¼Œç‚¹å‡»ç»§ç»­å®‰è£…å³å¯<br>
<img src="https://duzexu.github.io/post-images/1665995036880.jpg" alt="" loading="lazy"><br>
è‹¥æ˜¾ç¤ºæ— æ³•æ‰“å¼€ï¼Œåœ¨ç³»ç»Ÿåå¥½è®¾ç½®çš„å®‰å…¨æ€§ä¸éšç§ä¸­å…è®¸æ‰“å¼€è¯¥æ–‡ä»¶ã€‚</p>
<h2 id="openocd">openocd</h2>
<p>Apple siliconä¸‹è½½<a href="https://github.com/xpack-dev-tools/openocd-xpack/releases">è¯¥ç‰ˆæœ¬</a>ï¼Œå¦‚å›¾æ‰€ç¤ºä¸‹è½½ç¬¬ä¸€ä¸ªã€‚è§£å‹åå‚¨å­˜åœ¨å›ºå®šä½ç½®ï¼Œæˆ‘æ”¾åœ¨äº†/Library/xpack-openocd-0.11.0-3<br>
<img src="https://duzexu.github.io/post-images/1665995138130.webp" alt="" loading="lazy"></p>
<p>åŸºäºIntelçš„Macå¯ä»¥ç›´æ¥é€šè¿‡homebrewå®‰è£…</p>
<pre><code>brew install openocd
</code></pre>
<p>åœ¨ç»ˆç«¯è¾“å…¥<code>which openocd</code>æŸ¥çœ‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å®‰è£…ä½ç½®</p>
<h2 id="xcode">xcode</h2>
<p>app store æœç´¢Xcodeå³å¯å®‰è£…</p>
<h2 id="arm-gccå·¥å…·é“¾">ARM-GCCå·¥å…·é“¾</h2>
<p>ä½¿ç”¨Homebrewå®‰è£…</p>
<pre><code>brew tap ArmMbed/homebrew-formulae
brew install arm-none-eabi-gcc
</code></pre>
<p>å®‰è£…åè¾“å…¥<code>arm-none-eabi-gcc -v</code>æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼Œæœ‰ä¿¡æ¯åˆ™å®‰è£…æˆåŠŸ</p>
<h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h2>
<p>æ‰“å¼€Clionï¼Œcommend+,è¿›å…¥åå¥½è®¾ç½®</p>
<p>é€‰æ‹©åµŒå…¥å¼å¼€å‘ï¼Œå°†è½¯ä»¶è·¯å¾„è¾“å…¥ï¼Œç‚¹å‡»æµ‹è¯•å¯ä»¥æŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿå·¥ä½œ</p>
<p><img src="https://duzexu.github.io/post-images/1665995285616.webp" alt="" loading="lazy"><br>
æ’ä»¶å®‰è£…<br>
<img src="https://duzexu.github.io/post-images/1665995290414.webp" alt="" loading="lazy"></p>
<p>å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/145801160">é…ç½®CLionç”¨äºSTM32å¼€å‘ã€ä¼˜é›…ã®åµŒå…¥å¼å¼€å‘ã€‘</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidä¸­å½•åˆ¶å’Œæˆªå–Unityå±å¹•]]></title>
        <id>https://duzexu.github.io/post/Record_Screen_In_Unity_For_Andriod/</id>
        <link href="https://duzexu.github.io/post/Record_Screen_In_Unity_For_Andriod/">
        </link>
        <updated>2022-04-02T09:42:17.000Z</updated>
        <summary type="html"><![CDATA[<p>è¿™ç¯‡æ˜¯ä¹‹å‰<a href="https://duzexu.github.io/post/Record_Screen_In_Unity/">iOSä¸­å½•åˆ¶å’Œæˆªå–Unityå±å¹•</a>çš„æ‰©å±•ï¼Œä»‹ç»å¦‚ä½•åœ¨é›†æˆUnityçš„AndroidåŸç”Ÿé¡¹ç›®ä¸­æˆªå–å’Œå½•åˆ¶å±å¹•å’Œå£°éŸ³</p>
]]></summary>
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ˜¯ä¹‹å‰<a href="https://duzexu.github.io/post/Record_Screen_In_Unity/">iOSä¸­å½•åˆ¶å’Œæˆªå–Unityå±å¹•</a>çš„æ‰©å±•ï¼Œä»‹ç»å¦‚ä½•åœ¨é›†æˆUnityçš„AndroidåŸç”Ÿé¡¹ç›®ä¸­æˆªå–å’Œå½•åˆ¶å±å¹•å’Œå£°éŸ³</p>
<!-- more -->
<p>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹<a href="https://github.com/duzexu/Record_Screen_In_Unity.git">Record_Screen_In_Unity</a></p>
<p>ä¸»è¦æ€è·¯è¿˜æ˜¯è·ŸiOSä¸€æ ·ï¼Œåœ¨Unityé‡Œè·å–å½“å‰å±å¹•æˆªå›¾ï¼Œä¼ ç»™native,åŸç”Ÿä½¿ç”¨MediaCodecè¿›è¡Œè§†é¢‘çš„åˆæˆ</p>
<h3 id="1-å‡†å¤‡å·¥ä½œ">1. å‡†å¤‡å·¥ä½œ</h3>
<p>æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰çš„Unityé¡¹ç›®ï¼ŒUnityç«¯çš„é‡‡é›†æ–¹æ³•ä¸å˜ï¼Œåœ¨<code>NativeInterface.cs</code>ä¸­æ·»åŠ å®‰å“çš„æ¥å£ã€‚å‚è€ƒ<a href="https://github.com/duzexu/Use-Unity-as-Library/blob/master/docs/android.md">Integrating Unity as a library into standard Android app</a>å°†Unityé¡¹ç›®å¯¼å‡ºåˆ°AndroidBuildæ–‡ä»¶å¤¹ä¸‹å¹¶é›†æˆåˆ°åŸç”Ÿå·¥ç¨‹ä¸­</p>
<blockquote>
<p>å¯¼å‡ºæ—¶æ¨¡å¼é€‰æ‹©<code>IL2CPP</code>æ¨¡å¼æ—¶éœ€è¦åœ¨<code>gradle.properties</code>æ–‡ä»¶ä¸­æ·»åŠ <em>unityStreamingAssets=.unity3d</em><br>
<img src="https://duzexu.github.io/post-images/1648894470716.png" alt="" loading="lazy"></p>
</blockquote>
<blockquote>
<p>ä¿®æ”¹unityLibraryçš„<code>build.gradle</code>æ–‡ä»¶ï¼Œæ·»åŠ <code>implementation 'androidx.appcompat:appcompat:1.1.0'</code><br>
<img src="https://duzexu.github.io/post-images/1649214579099.png" alt="" loading="lazy"></p>
</blockquote>
<blockquote>
<p>å°†<code>UnityPlayerActivity</code>çš„çˆ¶ç±»ç”±<code>Activity</code>ä¿®æ”¹ä¸º<code>AppCompatActivity</code><br>
<img src="https://duzexu.github.io/post-images/1649214711771.png" alt="" loading="lazy"></p>
</blockquote>
<h3 id="2è§†é¢‘å¸§å’ŒéŸ³é¢‘çš„ä¼ è¾“">2.è§†é¢‘å¸§å’ŒéŸ³é¢‘çš„ä¼ è¾“</h3>
<p>æŒ‰ç…§iOSçš„æ€è·¯ï¼Œå®‰å“é‡‡ç”¨å¸¸è§„çš„<code>AndroidJavaClass.Call</code>çš„æ–¹å¼ç»™åŸç”Ÿä¼ è¾“è§†é¢‘å¸§ï¼Œç»è¿‡æµ‹è¯•å‘ç°è¿™ç§æ–¹å¼éå¸¸å¡ï¼Œå‡ºæ¥çš„è§†é¢‘å¸§ç‡è¿˜ä¸åˆ°15ï¼Œç»è¿‡è°ƒç ”ï¼Œé‡‡å–cåº“ä¸­è½¬çš„æ–¹å¼ä¼ è¾“ã€‚ä½¿ç”¨CMakeå»ºç«‹<code>RecordSDK</code>åº“ï¼Œå…¶ä¸­ç»´æŠ¤ä¸€ä¸ª<code>TPCircularBuffer</code>ï¼Œç¼“å­˜æœ€å¤šä¸‰å¸§æ•°æ®ï¼ŒUnityé€šè¿‡<code>copyVideoBuffer2Cyc</code>å°†æ•°æ®ä¼ è¾“ç»™<code>TPCircularBuffer</code>ç¼“å­˜ï¼Œå®‰å“ç«¯é€šè¿‡ä¸€ä¸ªå¾ªç¯è¯¢é—®æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™é€šè¿‡<code>consumeVideoBuffer</code>è·å–ï¼Œç¼–ç åé€šè¿‡<code>recycleVideoBuffer</code>é‡Šæ”¾è¿™ä¸€å¸§æ•°æ®ï¼Œå¥½æ¥å—æ–°çš„è§†é¢‘å¸§ã€‚éŸ³é¢‘æ•°æ®ä¹Ÿæ˜¯åŒæ ·çš„åŸç†ã€‚</p>
<h3 id="3-nativeç«¯">3. Nativeç«¯</h3>
<p>ç”±äºUnityé‡‡é›†çš„æ•°æ®ä¸º<code>BGRA32</code>æ ¼å¼å¹¶ä¸”æ˜¯å‚ç›´é•œåƒçš„ï¼Œå°†<code>KEY_COLOR_FORMAT</code>è®¾ç½®ä¸º<code>COLOR_Format32bitBGRA8888</code>åå‘ç°æ‰‹æœºä¸æ”¯æŒè¿™ä¸ªé¢œè‰²æ ¼å¼å¯¼è‡´ç¼–ç ä¸æˆåŠŸï¼Œåªèƒ½åœ¨cåº“æ¥æ”¶æ•°æ®æ—¶é€šè¿‡<code>libyuv</code>è½¬æˆ<code>nv21</code>æ ¼å¼ï¼Œè¿˜è¦æ ¹æ®æ‰‹æœºæ”¯æŒçš„é¢œè‰²æ ¼å¼è½¬æˆå¯¹åº”çš„yuvæ ¼å¼å’Œé•œåƒæ—‹è½¬ã€‚</p>
<pre><code class="language-java">//inputä¸ºCameraé¢„è§ˆæ ¼å¼NV21æ•°æ®
if (mColorFormat == MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420SemiPlanar) {
    //nv21æ ¼å¼è½¬ä¸ºnv12æ ¼å¼
    Nv21ToNv12(input, yuvBuffer, mWidth, mHeight);
} else if (mColorFormat == MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Planar) {
    //ç”¨äºNV21æ ¼å¼è½¬æ¢ä¸ºI420(YUV420P)æ ¼å¼
    Nv21ToI420(input, yuvBuffer, mWidth, mHeight);
} else if (mColorFormat == MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420PackedSemiPlanar) {
    System.arraycopy(input, 0, yuvBuffer, 0, mWidth * mHeight * 3 / 2);
}else if (mColorFormat == MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420PackedPlanar) {
    //ç”¨äºNV21æ ¼å¼è½¬æ¢ä¸ºYV12æ ¼å¼
    Nv21ToYv12(input, yuvBuffer, mWidth, mHeight);
}
MirrorYuv(yuvBuffer,mWidth,mHeight);
</code></pre>
<h3 id="4-éŸ³é¢‘å½•åˆ¶">4. éŸ³é¢‘å½•åˆ¶</h3>
<p>éŸ³é¢‘é‡‡é›†å’ŒiOSç«¯æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨UnityåŸç”Ÿçš„<code>VideoPlayer</code>åœ¨å½•åˆ¶æ—¶è§†é¢‘æ’­æ”¾å£°éŸ³ä¼šäº§ç”Ÿå¡é¡¿ï¼Œå¹¶ä¸”åœ¨å®‰å“ç«¯<code>VideoPlayer</code>çš„å…¼å®¹æ€§ä¹Ÿä¸å¥½ï¼Œç»å¸¸ä¼šå› ä¸ºè§†é¢‘æœ‰åå¸§å¯¼è§†å¡ä½ï¼Œæ‰€ä»¥æ›¿æ¢æˆäº†ç¬¬ä¸‰æ–¹çš„<code>AVPro Video</code>ã€‚</p>
<p>æ·»åŠ <code>MediaPlayer</code>ç»„ä»¶è¿›è¡Œæ’­æ”¾ï¼Œå¹¶ä¸”æ·»åŠ <code>AudioOutput</code>æŠŠå£°éŸ³é€šè¿‡<code>AudioSource</code>ä¼ è¾“ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>OnAudioFilterRead(float[] data, int channels)</code>é‡‡é›†å£°éŸ³ä¼ ç»™Nativeç«¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯VideoApiéœ€è¦é€‰ä¸º<code>Exo Player</code>å¹¶ä¸”<code>Audio Output</code>ä¸ºUnity<br>
<img src="https://duzexu.github.io/post-images/1648897605643.png" alt="" loading="lazy"></p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://github.com/duzexu/Use-Unity-as-Library/blob/master/docs/android.md">Integrating Unity as a library into standard Android app</a></p>
<p><a href="https://www.renderheads.com/content/docs/AVProVideo/articles/intro.html">AVPro Video Documentation</a></p>
<p>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹<a href="https://github.com/duzexu/Record_Screen_In_Unity.git">Record_Screen_In_Unity</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åœ¨iPhoneä¸Šå¼€å‘å¾®ä¿¡è‡ªåŠ¨è·³ä¸€è·³æ’ä»¶]]></title>
        <id>https://duzexu.github.io/post/Auto-Jump-In-WeChat-Jump/</id>
        <link href="https://duzexu.github.io/post/Auto-Jump-In-WeChat-Jump/">
        </link>
        <updated>2020-08-17T09:59:46.000Z</updated>
        <summary type="html"><![CDATA[<p>ç°åœ¨å·²æœ‰çš„å®ç°æ–¹æ³•åŸºæœ¬æ˜¯PCç«¯åˆ©ç”¨Pythonæ¥å®ç°çš„ï¼Œè¿˜å¾—å®‰è£…å¾ˆå¤šå·¥å…·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ä¸æ–¹ä¾¿ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åœ¨iOSä¸Šåˆ©ç”¨åŸç”Ÿå®¢æˆ·ç«¯å®ç°è‡ªåŠ¨è·³ä¸€è·³ï¼Œæ–¹ä¾¿éšæ—¶ä½¿ç”¨</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç°åœ¨å·²æœ‰çš„å®ç°æ–¹æ³•åŸºæœ¬æ˜¯PCç«¯åˆ©ç”¨Pythonæ¥å®ç°çš„ï¼Œè¿˜å¾—å®‰è£…å¾ˆå¤šå·¥å…·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ä¸æ–¹ä¾¿ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åœ¨iOSä¸Šåˆ©ç”¨åŸç”Ÿå®¢æˆ·ç«¯å®ç°è‡ªåŠ¨è·³ä¸€è·³ï¼Œæ–¹ä¾¿éšæ—¶ä½¿ç”¨</p>
<!-- more -->
<figure data-type="image" tabindex="1"><img src="https://duzexu.github.io/post-images/1597660201231.gif" alt="" loading="lazy"></figure>
<p>å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/duzexu/WeChatHelper">WeChatHelper</a></p>
<h3 id="åŸç†">åŸç†</h3>
<p>å’ŒPCç«¯å®ç°åŸç†ä¸€è‡´ï¼Œå…ˆç”¨ç³»ç»ŸAPIè¿›è¡Œå±å¹•æˆªå›¾ï¼Œåˆ©ç”¨<a href="https://github.com/opencv/opencv">OpenCV</a>åˆ†æå‡ºæ£‹å­çš„ä½ç½®å’Œç›®æ ‡å—çš„ä½ç½®ï¼Œè®¡ç®—å‡ºè·ç¦»ä¹˜ä»¥ç³»æ•°åå¾—å‡ºéœ€è¦æŒ‰å‹çš„æ—¶é—´ï¼Œç”¨<a href="https://github.com/devliubo/FTFakeTouch">FTFakeTouch</a>æ¨¡æ‹Ÿç›¸åº”çš„æŒ‰å‹äº‹ä»¶å°±è¡Œäº†</p>
<h3 id="å¦‚ä½•è¿›è¡Œä¸è¶Šç‹±æ’ä»¶å¼€å‘">å¦‚ä½•è¿›è¡Œä¸è¶Šç‹±æ’ä»¶å¼€å‘</h3>
<p>å…³äºè¿™éƒ¨åˆ†ï¼Œæœ‰å¾ˆå¤šç›¸å…³çš„æ¡†æ¶ï¼Œä¾‹å¦‚<a href="https://github.com/Naituw/IPAPatch">IPAPatch</a>æˆ–è€…<a href="https://github.com/AloneMonkey/MonkeyDev">MonkeyDev</a>ï¼Œè¿™é‡Œå°±ä¸åœ¨è¿‡å¤šä»‹ç»äº†ï¼Œå¯ä»¥å‚è€ƒç›¸åº”çš„æ–‡ç« æˆ–è€…é¡¹ç›®ç®€ä»‹</p>
<h3 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h3>
<h5 id="1æ­å»ºç¯å¢ƒ">1.æ­å»ºç¯å¢ƒ</h5>
<p>æœ¬ä¾‹å­é‡‡ç”¨çš„æ˜¯<code>IPAPatch</code>ï¼Œæˆ‘ä»¬å…ˆå–å¾—å¾®ä¿¡çš„ç ¸å£³æ–‡ä»¶(è‡ªå·±ç ¸å£³æˆ–è€…ä»è¶Šç‹±æ¸ é“ä¸‹è½½éƒ½è¡Œ)ï¼Œç„¶åä¸‹è½½IPAPatch Demoå·¥ç¨‹ï¼Œæ›¿æ¢<code>Assets</code>æ–‡ä»¶å¤¹ä¸‹çš„app.iapä¸ºå¾®ä¿¡çš„iapç ¸å£³æ–‡ä»¶ï¼Œä¸‹è½½<code>OpenCV</code>ä»£ç ç¼–è¯‘ä¸º<code>opencv2.framework</code>æ·»åŠ å…¥å·¥ç¨‹ï¼Œä¸‹è½½<code>FTFakeTouch</code>å·¥ç¨‹ç¼–è¯‘æˆ<code>FTFakeTouch.a</code>åº“æ·»åŠ å…¥å·¥ç¨‹ï¼Œæ–°å»º<code>WeChatJumpManager</code>ç±»æ·»åŠ å…¥å·¥ç¨‹æ¥ä½œä¸ºæˆ‘ä»¬å®ç°ç›¸å…³åŠŸèƒ½çš„ç±»ï¼Œè¿™æ ·å‡†å¤‡å·¥ä½œå°±å®Œæˆäº†</p>
<h5 id="2è§¦å‘æ–¹æ³•">2.è§¦å‘æ–¹æ³•</h5>
<p>æˆ‘ä»¬é‡‡ç”¨æ‘‡ä¸€æ‘‡çš„æ–¹å¼å¼€å¯è‡ªåŠ¨è·³çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ·»åŠ <code>UIWindow</code>çš„<code>Category</code>ç›‘å¬ç³»ç»Ÿçš„æ‘‡ä¸€æ‘‡äº‹ä»¶</p>
<pre><code>@implementation UIWindow (Shake)
-(void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event {
    if (motion == UIEventSubtypeMotionShake) {
        //ç›‘å¬åˆ°æ‘‡åŠ¨äº‹ä»¶
    }
}
@end
</code></pre>
<h5 id="3æˆªå›¾">3.æˆªå›¾</h5>
<p>é‡‡ç”¨ç³»ç»Ÿçš„æˆªå›¾æ–¹æ³•</p>
<pre><code>- (UIImage *)getCurrentScreenShot {
    UIWindow *screenWindow = [UIApplication sharedApplication].keyWindow;
    UIGraphicsBeginImageContextWithOptions(screenWindow.frame.size, NO, [UIScreen mainScreen].scale);
    [screenWindow drawViewHierarchyInRect:screenWindow.frame afterScreenUpdates:YES];
    UIImage *viewImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return viewImage;
}
</code></pre>
<p>ç”¨<code>UIImageToMat</code>å°†UIImageè½¬æˆOpenCVä¸­ä½¿ç”¨çš„æ ¼å¼<code>cv::Mat</code></p>
<h5 id="4å®šä½æ£‹å­çš„ä½ç½®">4.å®šä½æ£‹å­çš„ä½ç½®</h5>
<p>OpenCVçš„<code>matchTemplate</code>æ–¹æ³•å¯ä»¥æ ¹æ®æ¨¡æ¿å›¾ç‰‡æŸ¥æ‰¾åœ¨å¯¹åº”çš„ç›®æ ‡å›¾ç‰‡ä¸­çš„ä½ç½®ï¼Œæ­£å¥½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å…ˆæˆªå–ä¸€ä¸ªæ£‹å­çš„æ¨¡æ¿æ–‡ä»¶</p>
<figure data-type="image" tabindex="2"><img src="https://duzexu.github.io/post-images/1597660641561.jpg" alt="" loading="lazy"></figure>
<p>æ”¾å…¥<code>Assert</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>Resource</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆå§‹åŒ–ç›¸åº”çš„èµ„æºæ–‡ä»¶ä¼ å…¥ï¼Œè·å¾—æ£‹å­çš„ä½ç½®</p>
<pre><code>- (CvPoint)chess_Loc:(cv::Mat)res tempImage:(cv::Mat)temp result:(cv::Mat)result {
    cv::matchTemplate(res, temp, result, CV_TM_SQDIFF);
    double minVal,maxVal;
    CvPoint minLoc,maxLoc,matchLoc;
    IplImage image = IplImage(result);
    cvMinMaxLoc(&amp;image,&amp;minVal,&amp;maxVal,&amp;minLoc,&amp;maxLoc,NULL);
    matchLoc = minLoc; //matchLocæ˜¯æœ€ä½³åŒ¹é…çš„åŒºåŸŸå·¦ä¸Šè§’ç‚¹
    chessRect = cvRect(matchLoc.x, matchLoc.y, temp.cols, temp.rows);
    //æ ‡è®°å‡ºæ£‹å­çš„ä½ç½®
    cv::rectangle(res, cvRect(matchLoc.x, matchLoc.y, temp.cols, temp.rows), cvScalar(225,225,0));
    return cvPoint(matchLoc.x+temp.cols*0.5,matchLoc.y+temp.rows);
}
</code></pre>
<p>è¿™æ­¥å®Œæˆæˆ‘ä»¬å¯ä»¥è¿è¡Œæµ‹è¯•ä¸‹ï¼Œå°†ç»“æœè½¬æˆ<code>UIImage</code>å­˜å…¥ç›¸å†Œçœ‹ä¸‹æ£‹å­çš„ä½ç½®æ˜¯å¤Ÿæ­£ç¡®</p>
<figure data-type="image" tabindex="3"><img src="https://duzexu.github.io/post-images/1597661194726.JPG" alt="" loading="lazy"></figure>
<h5 id="5è·å¾—ä¸‹ä¸€æ­¥çš„ä½ç½®">5.è·å¾—ä¸‹ä¸€æ­¥çš„ä½ç½®</h5>
<p>æŸ¥æ‰¾ä¸‹ä¸€æ­¥ä½ç½®çš„å…³é”®å°±æ˜¯æ‰¾å‡ºä¸‹ä¸€ä¸ªæ–¹å—çš„ä½ç½®ï¼Œæˆ‘ä»¬æš‚ä¸”è®¤ä¸ºæ–¹å—çš„ä¸Šå°–çš„ä½ç½®å°±æ˜¯ä¸‹ä¸€ä¸ªæ–¹å—çš„ä½ç½®ï¼Œå…³é”®çš„æ–¹æ³•æ˜¯è¾¹ç¼˜æ£€æµ‹å‡½æ•°<code>Canny</code></p>
<ul>
<li>å…ˆç”¨<code>cvtColor</code>å°†å›¾ç‰‡è½¬åŒ–ä¸ºç°åº¦å›¾</li>
<li>è¾¹ç¼˜æ£€æµ‹å‰ç”¨é«˜æ–¯æ¨¡ç³Š<code>GaussianBlur</code>å¤„ç†ä¸‹ï¼Œæ–¹ä¾¿è¾¹ç¼˜æ£€æµ‹</li>
<li><code>Canny</code>å‡½æ•°è¿›è¡Œè¾¹ç¼˜æ£€æµ‹</li>
</ul>
<p>æˆ‘ä»¬æ³¨æ„åˆ°ç”±äºä¸‹ä¸€æ­¥çš„ä½ç½®è·ç¦»ä¸Šä¸€ä¸ªä½ç½®è¾ƒè¿‘æ—¶å¯èƒ½ä¼šå½±å“æ£‹å­çš„è¾¹ç¼˜å¯èƒ½ä¼šå½±å“åˆ°ä¸‹ä¸€æ­¥çš„ä½ç½®åˆ¤æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ ¹æ®ä¸Šä¸€æ­¥æ£‹å­çš„ä½ç½®å°†å®ƒçš„åƒç´ æ”¹ä¸º0</p>
<pre><code>cv::rectangle(res, chessRect, cvScalar(0), -1);
</code></pre>
<p>ç”±äºæœ‰æ•ˆçš„éƒ¨åˆ†æ˜¯å›¾ç‰‡çš„ä¸­é—´éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå¤„ç†é«˜åº¦ä¸º0.25åˆ°0.6ä¹‹é—´çš„éƒ¨åˆ†</p>
<p>æ ¹æ®æ£‹å­çš„ä½ç½®ç¡®å®šæŸ¥æ‰¾çš„èŒƒå›´ï¼Œè¿›è¡Œè¡Œæ‰«æï¼Œæ‰«æåˆ°çš„ç¬¬ä¸€ä¸ªå€¼ä¸º255çš„å³è¿”å›å½“å‰åæ ‡å€¼</p>
<p>å®éªŒä¸­å‘ç°æ¤­åœ†å½¢çš„ä¸Šå°–æ˜¯æ¡ç›´çº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è·å–ç¬¬ä¸€è¡Œè¿ç»­å€¼æ˜¯255çš„xå€¼çš„ä¸­ç‚¹</p>
<pre><code>- (CvPoint)nextStep_Loc:(cv::Mat)res chessPoint:(CvPoint)point {
    cvtColor(res, res, CV_BGR2GRAY);
    cv::GaussianBlur(res,res,cvSize(3,3),0);
    cv::Canny(res, res, 3, 9);
    cv::rectangle(res, chessRect, cvScalar(0), -1);
    int minX = 0,maxX = 0;
    int x = 0,y = 0;
    if (point.x &lt; res.cols/2.0) {
        for (int j = res.rows*0.25; j &lt; res.rows*0.6; j++) {
            uchar* ptr = res.ptr&lt;uchar&gt;(j);
            for (int i = res.cols/3.0; i &lt; res.cols; i++) {
                if (ptr[i] == 255) {
                    if (minX == 0) {
                        minX = i;
                    }
                }else{
                    if (minX != 0 &amp;&amp; maxX == 0) {
                        maxX = i;
                        x = (int)((maxX-minX)/2.0)+minX;
                        y = j;
                        return cvPoint(x, y);
                    }
                }
            }
        }
    }else{
        for (int j = res.rows*0.25; j &lt; res.rows*0.6; j++) {
            uchar* ptr = res.ptr&lt;uchar&gt;(j);
            for (int i = 0; i &lt; res.cols/3.0*2.0; i++) {
                if (ptr[i] == 255) {
                    if (minX == 0) {
                        minX = i;
                    }
                }else{
                    if (minX != 0 &amp;&amp; maxX == 0) {
                        maxX = i;
                        x = (int)((maxX-minX)/2.0)+minX;
                        y = j;
                        return cvPoint(x, y);
                    }
                }
            }
        }
    }
    return cvPoint(0, 0);
}
</code></pre>
<p>ç”¨<code>circle</code>å‡½æ•°åœ¨æˆ‘ä»¬è®¡ç®—å‡ºçš„ä½ç½®ä¸Šç”»ä¸ªåœˆï¼Œä¹Ÿä¿å­˜åˆ°ç›¸å†Œï¼ŒéªŒè¯ä¸‹ç»“æœ</p>
<figure data-type="image" tabindex="4"><img src="https://duzexu.github.io/post-images/1597661208775.JPG" alt="" loading="lazy"></figure>
<h5 id="6è®¡ç®—æ—¶é—´">6.è®¡ç®—æ—¶é—´</h5>
<p>æ ¹æ®ä¸Šä¸¤éƒ¨ç®—å‡ºæ¥çš„ä½ç½®ç®—å‡ºè·ç¦»è¿›è€Œå¾—å‡ºæ—¶é—´</p>
<pre><code>- (CGFloat)timeWithImage:(UIImage *)image {
    @autoreleasepool {
        cv::Mat s;
        UIImageToMat(image, s);
        cv::Mat r = s.clone();
        CvPoint p = [self chess_Loc:s tempImage:chess result:r];
        CvPoint n = [self nextStep_Loc:s chessPoint:p];
        s.release();
        r.release();
        if (n.x != 0&amp;&amp;n.y != 0) {
            double distance = [self distanceBetweenPointA:p pointB:cvPoint(n.x, n.y)];
            return distance*coefficient/1000.0;
        }else{
            return 0.3;
        }
    }
}
</code></pre>
<h5 id="7æ“ä½œæŒ‰å‹">7.æ“ä½œæŒ‰å‹</h5>
<p>éšæœºä¸€ä¸ªå±å¹•ä¸‹éƒ¨åˆ†çš„ç‚¹ï¼Œç”¨<code>FTFakeTouch</code>çš„<code>longPressAtPoint:duration:</code>å®ç°é•¿æŒ‰</p>
<pre><code>CGFloat x = (int)(randomRect.origin.x + (arc4random() % (int)randomRect.size.width));
                    CGFloat y = (int)(randomRect.origin.y + (arc4random() % (int)randomRect.size.height));
                    [[FTFakeTouch sharedInstance] longPressAtPoint:CGPointMake(x, y) duration:time];
</code></pre>
<p>ä»¥ä¸Šå°±å®ç°äº†æ•´ä¸ªéœ€æ±‚ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„æ‰‹æœºå¤§å°è¯•éªŒå‡ºè‡ªå·±çš„ç³»æ•°</p>
<p>å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/duzexu/WeChatHelper">WeChatHelper</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[iOSä¸­å½•åˆ¶å’Œæˆªå–Unityå±å¹•]]></title>
        <id>https://duzexu.github.io/post/Record_Screen_In_Unity/</id>
        <link href="https://duzexu.github.io/post/Record_Screen_In_Unity/">
        </link>
        <updated>2020-08-14T07:24:45.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨é›†æˆUnityçš„iOSåŸç”Ÿé¡¹ç›®ä¸­æˆªå–å’Œå½•åˆ¶å±å¹•</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨é›†æˆUnityçš„iOSåŸç”Ÿé¡¹ç›®ä¸­æˆªå–å’Œå½•åˆ¶å±å¹•</p>
<!-- more -->
<p>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹<a href="https://github.com/duzexu/Record_Screen_In_Unity.git">Record_Screen_In_Unity</a></p>
<p>ç”±äºUnityä¸ç†Ÿç»ƒï¼Œä¸çŸ¥é“æ€ä¹ˆç›´æ¥åœ¨Unityé‡Œå½•åˆ¶å±å¹•ã€‚æŸ¥è¯¢ç½‘ä¸Šçš„æ–¹æ³•ï¼ŒåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨Unityçš„æ’ä»¶å½•åˆ¶ï¼Œä¸è¿‡åŸºæœ¬éƒ½æ˜¯æ”¶è´¹æ’ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨æ›²çº¿æ•‘å›½ï¼Œè‡ªå·±åˆ¶ä½œå½•åˆ¶è„šæœ¬ã€‚</p>
<p>æ€è·¯æ˜¯é¦–å…ˆåœ¨Unityé‡Œè·å–å½“å‰å±å¹•æˆªå›¾ï¼Œä¼ ç»™native,åŸç”Ÿä½¿ç”¨GPUImageè¿›è¡Œè§†é¢‘çš„åˆæˆ</p>
<h3 id="1-å‡†å¤‡å·¥ä½œ">1. å‡†å¤‡å·¥ä½œ</h3>
<p>æ–°å»ºä¸€ä¸ªUnityå’ŒåŸç”Ÿæ··åˆçš„å·¥ç¨‹ï¼ˆå‚è€ƒä¹‹å‰çš„<a href="https://github.com/duzexu/Use-Unity-as-Library.git">æ–‡ç« </a>ï¼‰ï¼Œåœ¨ä¸»åœºæ™¯ä¸­æ”¾ç½®ä¸€ä¸ªç™½è‰²çš„çƒï¼Œæ–¹ä¾¿æˆ‘ä»¬å½•åˆ¶æ—¶éªŒè¯</p>
<h3 id="2-unityç«¯">2. Unityç«¯</h3>
<ul>
<li>è·å–ARæ‘„åƒå¤´é‡‡é›†çš„åŸå§‹æ•°æ®</li>
</ul>
<p>ä½¿ç”¨<code>ARCameraManager</code>çš„<code>TryGetLatestImage</code>æ–¹æ³•è·å–<code>XRCameraImage</code>å¯¹è±¡ï¼Œå†ç”¨<code>XRCameraImageConversionParams</code>æŠŠæ•°æ®è½¬æˆéœ€è¦çš„æ ¼å¼</p>
<pre><code>cameraManager.TryGetLatestImage(out XRCameraImage image)

renderTexture = new Texture2D(image.width, image.height, TextureFormat.BGRA32, false);
conversionParams = new XRCameraImageConversionParams(image, TextureFormat.BGRA32, CameraImageTransformation.None);
intPtr = new IntPtr(renderTexture.GetRawTextureData&lt;byte&gt;().GetUnsafePtr());

var rawTextureData = renderTexture.GetRawTextureData&lt;byte&gt;();
try
{
    image.Convert(conversionParams, intPtr, rawTextureData.Length);
}
finally
{
    image.Dispose();
}

renderTexture.Apply();

NativeAPI.SendVideoData(renderTexture.GetRawTextureData(), rawTextureData.Length);
</code></pre>
<ul>
<li>è·å–å±å¹•æ¸²æŸ“ç»“æœ</li>
</ul>
<p>ä½¿ç”¨<code>Texture2D</code>çš„<code>ReadPixels</code>è·å–å±å¹•æ¸²æŸ“ç»“æœ</p>
<pre><code>renderTexture.ReadPixels(new Rect(0, 0, Screen.width, Screen.height), 0, 0);
renderTexture.Apply();

byte[] rawData = renderTexture.GetRawTextureData();
NativeAPI.SendVideoData(rawData, rawData.Length);
</code></pre>
<h3 id="3-nativeç«¯">3. Nativeç«¯</h3>
<p>ä½¿ç”¨<code>GPUImageRawDataInput</code>ä½œä¸ºè¾“å…¥ï¼Œ<code>GPUImageMovieWriter</code>ä½œä¸ºè¾“å‡º<br>
æ‘„åƒå¤´æ•°æ®æ˜¯æ—‹è½¬çš„ï¼Œæ·»åŠ <code>GPUImageTransformFilter</code>æ—‹è½¬å›æ¥<br>
å¦‚æœä¸æ˜¯å½•åˆ¶å…¨å±ï¼Œæ·»åŠ <code>GPUImageCropFilter</code>æˆªå–å±å¹•çš„æŸä¸€éƒ¨åˆ†</p>
<p><strong><code>æ³¨æ„:</code></strong> åˆå§‹åŒ–GPUImageMovieWriteræ³¨æ„å®½é«˜éœ€è¦æ˜¯16çš„å€æ•°ï¼Œå¦åˆ™ä¼šæœ‰é»‘è¾¹</p>
<h3 id="4-éŸ³é¢‘å½•åˆ¶">4. éŸ³é¢‘å½•åˆ¶</h3>
<p>é€šè¿‡<code>OnAudioFilterRead(float[] data, int channels)</code>é‡‡é›†unityçš„å£°éŸ³ä¼ ç»™Nativeç«¯ï¼Œåœ¨Nativeç«¯å°†éŸ³é¢‘æ•°æ®è½¬ä¸º<code>CMSampleBuffer</code>å¡å…¥GPUImage</p>
<p>Unityè®¾ç½®çš„éŸ³é¢‘é‡‡æ ·ç‡è¦å’ŒNativeç«¯ç»Ÿä¸€</p>
<pre><code>AudioSettings.outputSampleRate = 44100;
</code></pre>
<p><strong><code>æ³¨æ„:</code></strong> <code>OnAudioFilterRead</code>æ–¹æ³•åªæœ‰åœ¨æ·»åŠ äº†<code>AudioSource</code>ç»„ä»¶åæ‰ä¼šå›è°ƒï¼Œå¹¶ä¸”AudioSourceçš„<code>playOnAwake</code>éœ€è¦ä¸º<code>false</code></p>
<p>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹<a href="https://github.com/duzexu/Record_Screen_In_Unity.git">Record_Screen_In_Unity</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¥‡æŠ€æ·«å·§ç»™ARèƒŒæ™¯æ·»åŠ æ»¤é•œ]]></title>
        <id>https://duzexu.github.io/post/Add_Filter_To_ARKit/</id>
        <link href="https://duzexu.github.io/post/Add_Filter_To_ARKit/">
        </link>
        <updated>2020-07-23T04:04:37.000Z</updated>
        <summary type="html"><![CDATA[<p>ARKitæ˜¯è‹¹æœåœ¨2017å¹´æ¨å‡ºçš„ARå¼€å‘å¹³å°ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨è¿™å¥—å·¥å…·iPhoneå’ŒiPadåˆ›å»ºå¢å¼ºç°å®åº”ç”¨ç¨‹åºã€‚</p>
<p>æœ¬æ–‡ä»¥ARKitæä¾›çš„<code>ARSCNView</code>ä¸ºä¾‹å®ç°ç»™ARèƒŒæ™¯æ·»åŠ æ»¤é•œã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ARKitæ˜¯è‹¹æœåœ¨2017å¹´æ¨å‡ºçš„ARå¼€å‘å¹³å°ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨è¿™å¥—å·¥å…·iPhoneå’ŒiPadåˆ›å»ºå¢å¼ºç°å®åº”ç”¨ç¨‹åºã€‚</p>
<p>æœ¬æ–‡ä»¥ARKitæä¾›çš„<code>ARSCNView</code>ä¸ºä¾‹å®ç°ç»™ARèƒŒæ™¯æ·»åŠ æ»¤é•œã€‚</p>
<!-- more -->
<p>å…ˆæ”¾ä»£ç  <a href="https://github.com/duzexu/Add-Filter-To-ARKit.git">Add Filter To ARKit</a></p>
<p>å¹³å¸¸å¼€å‘ä¸»è¦ä½¿ç”¨ARKitä¸­çš„<code>ARSCNView</code>ï¼Œæˆ–è€…ä½¿ç”¨iOS13æ–°æ¨å‡ºçš„<code>RealityKit</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Metalæˆ–è€…OpenGLè‡ªå·±æ¸²æŸ“ã€‚å¦‚æœæ˜¯è‡ªå·±æ¸²æŸ“ï¼Œæ•´ä¸ªçš„æ¸²æŸ“è¿‡ç¨‹éƒ½æ˜¯è‡ªå·±æ§åˆ¶çš„ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ·»åŠ æ»¤é•œï¼Œä½†æ˜¯éœ€è¦ç¹ççš„æ¸²æŸ“ä»£ç å’Œ3Dæ•°å­¦çŸ¥è¯†ã€‚ä½¿ç”¨ç³»ç»Ÿæä¾›çš„æ§ä»¶ï¼Œå¥½å¤„æ˜¯æˆ‘ä»¬ä¸éœ€è¦å…³æ³¨æ¸²æŸ“çš„è¿‡ç¨‹å’Œæ§åˆ¶æ‘„åƒæœºçš„è¿åŠ¨ï¼Œåªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯ç³»ç»Ÿå¹¶æ²¡æœ‰ç»™æˆ‘ä»¬æš´éœ²è‡ªå®šä¹‰æ¸²æŸ“çš„æ–¹æ³•ã€‚</p>
<h3 id="æ€è·¯">æ€è·¯</h3>
<p>æˆ‘ä»¬çŸ¥é“<code>ARSession</code>è¿™ä¸ªç±»æ˜¯ARKitçš„æ ¸å¿ƒï¼Œä»–è´Ÿè´£æ‘„åƒå¤´æ•°æ®çš„é‡‡é›†ï¼Œåˆ†æï¼Œå’Œå¤„ç†ï¼Œä»ç¡¬ä»¶ä¸­è¯»å–æ‰‹æœºå§¿æ€ç­‰ä¿¡æ¯ï¼Œç»¼åˆæ‰€æœ‰ç»“æœï¼Œåœ¨ä½ çš„ç°å®ä¸–ç•Œå’Œåˆ›å»ºçš„è™šæ‹Ÿä¸–ç•Œä¹‹é—´åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„å…³ç³»ï¼Œä»è€Œæ„å»ºå‡ºä¸€ä¸ªARä¸–ç•Œã€‚</p>
<p>æˆ‘ä»¬ä»<code>ARSession</code>å…¥æ‰‹æŸ¥æ‰¾å‘ç°<code>ARSessionDelegate</code>æœ‰ä¸€ä¸ªæ–¹æ³•</p>
<pre><code>/**
 This is called when a new frame has been updated.
 
 @param session The session being run.
 @param frame The frame that has been updated.
 */
optional func session(_ session: ARSession, didUpdate frame: ARFrame)
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ¯æ¬¡æœ‰æ–°<code>ARFrame</code>éƒ½ä¼šå›è°ƒï¼ŒæŸ¥çœ‹<code>ARFrame</code>çš„<code>capturedImage</code>æ˜¯è®°å½•æ¯æ¬¡æ‘„åƒæœºé‡‡é›†çš„ç”»é¢ï¼Œé‚£æˆ‘ä»¬çŒœæµ‹æ¯æ¬¡<code>ARSession</code>å¤„ç†å®Œä¼šä¼ ç»™<code>ARSCNView</code>ï¼Œ<code>ARSCNView</code>è·å–<code>ARFrame</code>çš„<code>capturedImage</code>æ¥æ¸²æŸ“ï¼Œå¦‚æœå¯ä»¥åœ¨ç³»ç»Ÿè·å–<code>capturedImage</code>ä¹‹å‰ä¿®æ”¹ä¸ºæ·»åŠ æ»¤é•œåçš„æ•°æ®ï¼Œé‚£ç³»ç»Ÿå°±ä¼šæ¸²æŸ“æ·»åŠ æ»¤é•œåçš„ç»“æœã€‚</p>
<h3 id="éªŒè¯">éªŒè¯</h3>
<p>æˆ‘ä»¬æ–°å»º<code>ARSession</code>çš„<code>Extension</code>ï¼Œåœ¨<code>+(void)load</code>æ–¹æ³•ä¸­äº¤æ¢ç³»ç»Ÿçš„<code>-(ARFrame *)currentFrame()</code>ä¸º<code>-(ARFrame *)_currentFrame()</code>æ–¹æ³•ï¼Œåœ¨<code>-(ARFrame *)_currentFrame()</code>ä¸­è¿”å›åŸå§‹å†…å®¹ï¼Œè¿è¡Œååœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ·»åŠ æ–­ç‚¹</p>
<figure data-type="image" tabindex="1"><img src="https://duzexu.github.io/post-images/1595561792446.jpg" alt="" loading="lazy"></figure>
<p>æŸ¥çœ‹è°ƒç”¨çš„æ–¹æ³•ä¸º<code>-[ARSCNView _renderer:updateAtTime:]</code>,çœ‹æ–¹æ³•ååƒæ˜¯æ¸²æŸ“çš„æ–¹æ³•<br>
åœ¨<code>-(ARFrame *)_currentFrame()</code>ä¸­å°†<code>capturedImage</code>çš„æ‰€æœ‰å†…å­˜æ•°æ®è®¾ç½®ä¸º0ï¼Œé‡æ–°è¿è¡Œï¼Œå‘ç°å±å¹•ä¸ºé»‘å±ï¼ŒéªŒè¯äº†æˆ‘ä»¬çš„çŒœæµ‹</p>
<h3 id="å®è·µ">å®è·µ</h3>
<p>æˆ‘ä»¬ä½¿ç”¨<code>GPUImage</code>æ¥å¤„ç†<code>capturedImage</code>ï¼Œå»ºç«‹ä¸€ä¸ª<code>GPUImageFilterPipeline</code>ï¼Œè¾“å…¥ä¸º<code>GPUImageMovie</code>ï¼Œç”¨æ¥æ¥æ”¶<code>capturedImage</code>çš„<code>CVPixelBuffer</code>æ•°æ®ï¼Œè¾“å‡ºä¸º<code>GPUImageFilter</code>ï¼Œç”¨æ¥è¾“å‡ºå¤„ç†å®Œçš„æ•°æ®ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥å¤„ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª<code>DispatchSemaphore</code>é”ï¼Œç­‰å¾…<code>GPUImage</code>å¤„ç†å®Œï¼Œå¤„ç†å®Œåå°†æ•°æ®å¤åˆ¶å›<code>capturedImage</code></p>
<pre><code> let output = GPUImageFilter()
 
 pipeline = GPUImageFilterPipeline(orderedFilters: [], input: input, output: output)
 
 output.frameProcessingCompletionBlock = { [weak self] (output, time) -&gt; Void  in
     let frameBuffer = output?.framebufferForOutput()
     
     guard let buffer = frameBuffer else {
         return;
     }
     
     glFinish()
     
     self?.rgbBuffer = buffer.getRenderTarget()?.takeUnretainedValue()
     
     self?.semaphore.signal()
 }
</code></pre>
<p>è¿è¡Œåå‘ç°å´©æºƒäº†ï¼ŒæŸ¥æ‰¾åŸå› å‘ç°<code>capturedImage</code>çš„<code>CVPixelBuffer</code>æ ¼å¼æ˜¯yuvçš„ï¼Œè€Œ<code>GPUImage</code>å¤„ç†å®Œçš„æ•°æ®ä¸ºrgbçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ <code>libyuv</code>åº“ï¼ŒæŠŠ<code>GPUImage</code>å¤„ç†å®Œçš„rgbæ•°æ®è½¬æˆyuvï¼Œåœ¨å¤åˆ¶å›<code>capturedImage</code></p>
<pre><code>CVPixelBufferLockBaseAddress(pixelBuffer, [])
let final_y_buffer = CVPixelBufferGetBaseAddressOfPlane(pixelBuffer, 0)?.assumingMemoryBound(to: uint8.self);
let final_uv_buffer = CVPixelBufferGetBaseAddressOfPlane(pixelBuffer, 1)?.assumingMemoryBound(to: uint8.self);
input.processMovieFrame(pixelBuffer, withSampleTime: .zero)
_ = semaphore.wait(timeout: .distantFuture)
CVPixelBufferLockBaseAddress(rgbBuffer!, [])
let width = CVPixelBufferGetWidth(rgbBuffer!)
let height = CVPixelBufferGetHeight(rgbBuffer!)
let rgbAddress = CVPixelBufferGetBaseAddress(rgbBuffer!)?.assumingMemoryBound(to: uint8.self)
ARGBToNV12(rgbAddress, Int32(width*4), final_y_buffer, Int32(width), final_uv_buffer, Int32(width), Int32(width), Int32(height))
CVPixelBufferUnlockBaseAddress(rgbBuffer!, [])
CVPixelBufferUnlockBaseAddress(pixelBuffer, [])
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ„åœ¨<code>GPUImageFilterPipeline</code>æ·»åŠ æˆ–åˆ é™¤æ»¤é•œäº†</p>
<p>æµ‹è¯•åå‘ç°å¦‚æœæ»¤é•œåˆ‡æ¢ç‰¹åˆ«å¿«ä¼šæœ‰éšæœºå´©æºƒï¼ŒçŒœæµ‹æ˜¯åˆ‡æ¢è¿‡ç¨‹å½±å“åˆ°æœ€åçš„æ•°æ®ï¼Œä¿®æ”¹ä¸ºç­‰å¾…ä¸Šä¸€å¸§å¤„ç†å®Œå†åˆ‡æ¢æ»¤é•œ</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬æ–‡é€šè¿‡æ¯”è¾ƒå–å·§çš„æ–¹å¼å®ç°äº†è¿™ä¸ªéœ€æ±‚ï¼Œæœ‰ç‚¹ä¸èµ°å¯»å¸¸è·¯ã€‚é‡‡ç”¨Unityç­‰ç°æˆçš„æ¸²æŸ“å¼•æ“ä¼šæ˜¯ä¸€ä¸ªç›¸å¯¹ç¨³å¦¥çš„æ–¹æ¡ˆï¼Œé›†æˆä¹Ÿå¾ˆç®€å•ï¼ˆå‚è€ƒä¹‹å‰çš„æ–‡ç«  <a href="https://github.com/duzexu/Use-Unity-as-Library.git">Use Unity as Library</a>ï¼‰ï¼Œç›´æ¥ç»™æ‘„åƒæœºæ·»åŠ æ»¤é•œè„šæœ¬å°±è¡Œäº†</p>
<p>æŸ¥çœ‹å…¨éƒ¨ä»£ç è¯·ç‚¹å‡» <a href="https://github.com/duzexu/Add-Filter-To-ARKit.git">Add Filter To ARKit</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å°†Unityä»¥åº“å½¢å¼é›†æˆåˆ°åŸç”ŸiOS]]></title>
        <id>https://duzexu.github.io/post/Use_Unity_as_Library/</id>
        <link href="https://duzexu.github.io/post/Use_Unity_as_Library/">
        </link>
        <updated>2020-05-20T10:20:06.000Z</updated>
        <summary type="html"><![CDATA[<p>Unity 2019.3åŠä¹‹åçš„ç‰ˆæœ¬å°†æ·»åŠ æ”¯æŒï¼Œå¯ä»¥å°†Unityä½œä¸ºåŸç”ŸAndroidå’ŒiOSåº”ç”¨æ§åˆ¶çš„åº“ï¼Œä»¥ä¾¿è½»æ¾åŠ å…¥ARå’Œå…¶å®ƒUnityåŠŸèƒ½ã€‚</p>
<p>è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥å°†Unityæ‰€èƒ½å®ç°çš„å¢å¼ºç°å®ARã€3D/2Då®æ—¶æ¸²æŸ“ã€2Dè¿·ä½ æ¸¸æˆç­‰åŠŸèƒ½ï¼Œç›´æ¥æ·»åŠ åˆ°è‡ªå·±çš„åŸç”Ÿç§»åŠ¨åº”ç”¨ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Unity 2019.3åŠä¹‹åçš„ç‰ˆæœ¬å°†æ·»åŠ æ”¯æŒï¼Œå¯ä»¥å°†Unityä½œä¸ºåŸç”ŸAndroidå’ŒiOSåº”ç”¨æ§åˆ¶çš„åº“ï¼Œä»¥ä¾¿è½»æ¾åŠ å…¥ARå’Œå…¶å®ƒUnityåŠŸèƒ½ã€‚</p>
<p>è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥å°†Unityæ‰€èƒ½å®ç°çš„å¢å¼ºç°å®ARã€3D/2Då®æ—¶æ¸²æŸ“ã€2Dè¿·ä½ æ¸¸æˆç­‰åŠŸèƒ½ï¼Œç›´æ¥æ·»åŠ åˆ°è‡ªå·±çš„åŸç”Ÿç§»åŠ¨åº”ç”¨ã€‚</p>
<!-- more -->
<p>ç›´æ¥ä¸Šä»£ç  <a href="https://github.com/duzexu/Use-Unity-as-Library.git">Use Unity as Library</a></p>
<h2 id="é™åˆ¶">é™åˆ¶</h2>
<ul>
<li>ä½œä¸ºåº“ä½¿ç”¨çš„Unityä»…æ”¯æŒå…¨å±æ¸²æŸ“ï¼Œä¸æ”¯æŒåœ¨å±å¹•çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ¸²æŸ“ã€‚</li>
<li>ä¸æ”¯æŒåŠ è½½å¤šä¸ªUnityè¿è¡Œæ—¶å®ä¾‹ã€‚</li>
<li>å¼€å‘è€…éœ€è¦è°ƒæ•´ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ŒåŒ…æ‹¬åŸç”Ÿæ’ä»¶å’Œæ‰˜ç®¡æ’ä»¶ï¼Œä»è€Œè®©å®ƒä»¬æ­£å¸¸å·¥ä½œã€‚</li>
</ul>
<h2 id="é›†æˆè¦æ±‚">é›†æˆè¦æ±‚</h2>
<ul>
<li>Xcode 9.4ä»¥ä¸Šç‰ˆæœ¬</li>
<li>Unity 2019.3.a2ä»¥ä¸Šç‰ˆæœ¬</li>
</ul>
<h2 id="é›†æˆæ­¥éª¤">é›†æˆæ­¥éª¤</h2>
<h4 id="1ä¸‹è½½ç¤ºä¾‹å·¥ç¨‹">1.ä¸‹è½½ç¤ºä¾‹å·¥ç¨‹</h4>
<ul>
<li>å…‹éš†æˆ–ä¸‹è½½ <a href="https://github.com/Unity-Technologies/uaal-example">Demo</a> è¿™åŒ…å«<br>
<img src="https://duzexu.github.io/post-images/1589971003144.png" alt="" loading="lazy">
<ul>
<li>UnityProject-è¿™æ˜¯Unityç¤ºä¾‹å·¥ç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†å‡ ä¸ªç®€å•çš„äº¤äº’ï¼Œæˆ‘ä»¬è¦å°†ä»–é›†æˆè¿›åŸç”Ÿå·¥ç¨‹ã€‚Assets/Plugins/iOS ä¸­çš„æ–‡ä»¶ï¼Œç”¨äºUnityä¸åŸç”Ÿåº”ç”¨è¿›è¡Œé€šä¿¡</li>
<li>NativeiOSApp-è¿™æ˜¯ç®€å•çš„iOSåŸç”Ÿåº”ç”¨ï¼Œæˆ‘ä»¬è¦åœ¨å…¶ä¸­é›†æˆUnityé¡¹ç›®ã€‚ä½¿ç”¨UnityFrameworkLoad()åŠ è½½Unityå¼•æ“</li>
</ul>
</li>
</ul>
<h4 id="2å¯¼å‡ºunityä¸ºxcodeé¡¹ç›®">2.å¯¼å‡ºUnityä¸ºXcodeé¡¹ç›®</h4>
<p>æ— éœ€ç‰¹åˆ«è®¾ç½®ï¼Œæ­£å¸¸ç”ŸæˆXcodeé¡¹ç›®</p>
<ul>
<li>ä»Unityç¼–è¾‘å™¨ä¸­æ‰“å¼€UnityProject</li>
<li>åˆ é™¤æˆ–æ›´æ–°å¹¿å‘Šè½¯ä»¶åŒ…è‡³v3.*ï¼ˆ2.0.8ç‰ˆæœ¬ä¸ä½œä¸ºåº“çš„Unityä¸å…¼å®¹ï¼‰ï¼ˆMenu/Window/Package Managerï¼‰</li>
<li>é€‰æ‹©å¹¶åˆ‡æ¢åˆ°å¹³å°iOSï¼ˆMenu/File/Builds Settingsï¼‰</li>
<li>ç‚¹å‡»Buildï¼Œé€‰æ‹©å¯¼å‡ºæ–‡ä»¶å¤¹UnityProject/Build,ç‚¹å‡»æ„å»º</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://duzexu.github.io/post-images/1589972003675.png" alt="" loading="lazy"></figure>
<h4 id="3è®¾ç½®xcode-workspace">3.è®¾ç½®Xcode workspace</h4>
<p>ä½¿ç”¨Xcode workspaceå°†åŸç”Ÿé¡¹ç›®å’Œå¯¼å‡ºçš„é¡¹ç›®é›†æˆåˆ°ä¸€èµ·</p>
<ul>
<li>æ–°å»ºUntitled.workspaceä¿å­˜åˆ°æ ¹ç›®å½•ä¸‹ ï¼ˆFile/New/Workspaceï¼‰</li>
<li>ç‚¹å‡»å·¦ä¸‹è§’çš„åŠ å·æ·»åŠ NativeiOSApp.xcodeprojå’Œç¬¬äºŒæ­¥ç”Ÿæˆçš„Unity-iPhone.xcodeprojï¼ˆFile / Add Files to &quot;Untitled&quot;ï¼‰<br>
<img src="https://duzexu.github.io/post-images/1590041804021.png" alt="" loading="lazy"></li>
</ul>
<h4 id="4æ·»åŠ unityframeworkframework">4.æ·»åŠ UnityFramework.framework</h4>
<p>è¿™ä¸ªæ­¥éª¤æŠŠUnityçš„å·¥ç¨‹å·²frameworkçš„å½¢å¼é›†æˆè¿›NativeiOSAppï¼Œä¸éœ€è¦æ”¹å˜NativeiOSAppçš„ç»“æ„</p>
<ul>
<li>åœ¨NativeiOSAppä¸­é€‰æ‹©NativeiOSApp target</li>
<li>åœ¨Build Phases/ Embedded Binariesæ ç›®ä¸­ç‚¹å‡»+</li>
<li>é€‰æ‹©Unity-iPhone/Products/UnityFramework.framework</li>
<li>åœ¨Build Phases/Linked Frameworks and Librariesä¸­ç§»é™¤UnityFramework.framework<br>
<img src="https://duzexu.github.io/post-images/1590042730744.png" alt="" loading="lazy"></li>
</ul>
<h4 id="5æš´éœ²nativecallproxyh">5.æš´éœ²NativeCallProxy.h</h4>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯Unityå’ŒåŸç”Ÿé¡¹ç›®æ¥å£çš„å®šä¹‰</p>
<ul>
<li>é€‰æ‹©Unity-iPhone / Libraries / Plugins / iOS / NativeCallProxy.h</li>
<li>åœ¨Inspector/Target Membershipä¸­é€‰æ‹©UnityFrameworkå¹¶è®¾ç½®ä¸ºPublic<br>
<img src="https://duzexu.github.io/post-images/1590043415570.png" alt="" loading="lazy"></li>
</ul>
<h4 id="6æš´éœ²dataæ–‡ä»¶å¤¹">6.æš´éœ²Dataæ–‡ä»¶å¤¹</h4>
<p>é»˜è®¤Dataæ–‡ä»¶æ˜¯å±äºUnity-iPhone targetï¼Œæˆ‘ä»¬è¦å°†ä»–æš´éœ²ç»™framework</p>
<ul>
<li>é€‰æ‹©Unity-iPhone/Dataæ–‡ä»¶å¤¹</li>
<li>åœ¨Inspector/Target Membershipä¸­é€‰æ‹©UnityFramework<br>
<img src="https://duzexu.github.io/post-images/1590044436630.png" alt="" loading="lazy"></li>
</ul>
<p>å¦‚æœé¡ºåˆ©ï¼Œç°åœ¨å°±å¯ä»¥æˆåŠŸçš„è¿è¡ŒNativeiOSAppäº†</p>
<h2 id="swifté›†æˆ">Swifté›†æˆ</h2>
<p>åŸç”ŸSwifté›†æˆè¿‡ç¨‹è·ŸOCçš„ä¸€æ ·ï¼Œåªä¸è¿‡NativeCallProxyçš„å®ç°éœ€è¦æ¡¥æ¥æ–‡ä»¶ã€‚åœ¨æ¡¥æ¥æ–‡ä»¶ä¸­å¼•å…¥</p>
<pre><code>#import &lt;UnityFramework/NativeCallProxy.h&gt;
</code></pre>
<p>æˆ‘æ–°å»ºäº†ä¸€ä¸ªUnitySwiftMix.workspace Demoæ¼”ç¤ºå¦‚ä½•åœ¨Swiftä¸­é›†æˆï¼Œå¹¶å°è£…äº†Unity Frameworkçš„æ¥å£ï¼ŒåŒæ—¶è¿™ä¸ªå·¥ç¨‹ä¹Ÿé›†æˆäº†Pod</p>
<p>è¯¦æƒ…è¯·ç‚¹å‡» <a href="https://github.com/duzexu/Use-Unity-as-Library.git">Use Unity as Library</a></p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://connect.unity.com/p/zai-yuan-sheng-ioshuo-androidying-yong-zhong-jiang-unityzuo-wei-ku-shi-yong">åœ¨åŸç”ŸiOSæˆ–Androidåº”ç”¨ä¸­å°†Unityä½œä¸ºåº“ä½¿ç”¨</a></p>
<p><a href="https://forum.unity.com/threads/integration-unity-as-a-library-in-native-ios-app.685219/">Integration Unity as a library in native iOS app</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://duzexu.github.io/post/hello-gridea/</id>
        <link href="https://duzexu.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="https://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>